{"ast":null,"code":"import { Group, Mesh, MeshLambertMaterial, Color, BufferGeometry, BufferAttribute, Matrix4, Vector3, SphereBufferGeometry, CylinderBufferGeometry, TubeBufferGeometry, ConeBufferGeometry, Line, LineBasicMaterial, QuadraticBezierCurve3, CubicBezierCurve3, Box3 } from 'three';\nimport { forceSimulation, forceLink, forceManyBody, forceCenter, forceRadial } from 'd3-force-3d';\nimport graph from 'ngraph.graph';\nimport forcelayout from 'ngraph.forcelayout';\nimport Kapsule from 'kapsule';\nimport accessorFn from 'accessor-fn';\nimport { min, max } from 'd3-array';\nimport dataJoint from 'data-joint';\nimport { scaleOrdinal } from 'd3-scale';\nimport { schemePaired } from 'd3-scale-chromatic';\nimport tinyColor from 'tinycolor2';\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n\n    if (enumerableOnly) {\n      symbols = symbols.filter(function (sym) {\n        return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n      });\n    }\n\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread2(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        _defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nfunction _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    _typeof = function (obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function (obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) _setPrototypeOf(subClass, superClass);\n}\n\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction _construct(Parent, args, Class) {\n  if (_isNativeReflectConstruct()) {\n    _construct = Reflect.construct;\n  } else {\n    _construct = function _construct(Parent, args, Class) {\n      var a = [null];\n      a.push.apply(a, args);\n      var Constructor = Function.bind.apply(Parent, a);\n      var instance = new Constructor();\n      if (Class) _setPrototypeOf(instance, Class.prototype);\n      return instance;\n    };\n  }\n\n  return _construct.apply(null, arguments);\n}\n\nfunction _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n\n  return target;\n}\n\nfunction _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n\n  var target = _objectWithoutPropertiesLoose(source, excluded);\n\n  var key, i;\n\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n\n  return target;\n}\n\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (typeof call === \"object\" || typeof call === \"function\")) {\n    return call;\n  }\n\n  return _assertThisInitialized(self);\n}\n\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n\n  return function _createSuperInternal() {\n    var Super = _getPrototypeOf(Derived),\n        result;\n\n    if (hasNativeReflectConstruct) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n\n    return _possibleConstructorReturn(this, result);\n  };\n}\n\nfunction _slicedToArray(arr, i) {\n  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();\n}\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return _arrayLikeToArray(arr);\n}\n\nfunction _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\n\nfunction _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter);\n}\n\nfunction _iterableToArrayLimit(arr, i) {\n  var _i = arr && (typeof Symbol !== \"undefined\" && arr[Symbol.iterator] || arr[\"@@iterator\"]);\n\n  if (_i == null) return;\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n\n  var _s, _e;\n\n  try {\n    for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\n\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];\n\n  return arr2;\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nvar materialDispose = function materialDispose(material) {\n  if (material instanceof Array) {\n    material.forEach(materialDispose);\n  } else {\n    if (material.map) {\n      material.map.dispose();\n    }\n\n    material.dispose();\n  }\n};\n\nvar deallocate = function deallocate(obj) {\n  if (obj.geometry) {\n    obj.geometry.dispose();\n  }\n\n  if (obj.material) {\n    materialDispose(obj.material);\n  }\n\n  if (obj.texture) {\n    obj.texture.dispose();\n  }\n\n  if (obj.children) {\n    obj.children.forEach(deallocate);\n  }\n};\n\nvar emptyObject = function emptyObject(obj) {\n  while (obj.children.length) {\n    var childObj = obj.children[0];\n    obj.remove(childObj);\n    deallocate(childObj);\n  }\n};\n\nvar _excluded = [\"objFilter\"];\n\nfunction threeDigest(data, scene) {\n  var _ref = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n  var _ref$objFilter = _ref.objFilter,\n      objFilter = _ref$objFilter === void 0 ? function () {\n    return true;\n  } : _ref$objFilter,\n      options = _objectWithoutProperties(_ref, _excluded);\n\n  return dataJoint(data, scene.children.filter(objFilter), function (obj) {\n    return scene.add(obj);\n  }, function (obj) {\n    scene.remove(obj);\n    emptyObject(obj);\n  }, _objectSpread2({\n    objBindAttr: '__threeObj'\n  }, options));\n}\n\nvar colorStr2Hex = function colorStr2Hex(str) {\n  return isNaN(str) ? parseInt(tinyColor(str).toHex(), 16) : str;\n};\n\nvar colorAlpha = function colorAlpha(str) {\n  return isNaN(str) ? tinyColor(str).getAlpha() : 1;\n};\n\nvar autoColorScale = scaleOrdinal(schemePaired); // Autoset attribute colorField by colorByAccessor property\n// If an object has already a color, don't set it\n// Objects can be nodes or links\n\nfunction autoColorObjects(objects, colorByAccessor, colorField) {\n  if (!colorByAccessor || typeof colorField !== 'string') return;\n  objects.filter(function (obj) {\n    return !obj[colorField];\n  }).forEach(function (obj) {\n    obj[colorField] = autoColorScale(colorByAccessor(obj));\n  });\n}\n\nfunction getDagDepths(_ref, idAccessor) {\n  var nodes = _ref.nodes,\n      links = _ref.links;\n\n  var _ref2 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},\n      _ref2$nodeFilter = _ref2.nodeFilter,\n      nodeFilter = _ref2$nodeFilter === void 0 ? function () {\n    return true;\n  } : _ref2$nodeFilter,\n      _ref2$onLoopError = _ref2.onLoopError,\n      onLoopError = _ref2$onLoopError === void 0 ? function (loopIds) {\n    throw \"Invalid DAG structure! Found cycle in node path: \".concat(loopIds.join(' -> '), \".\");\n  } : _ref2$onLoopError; // linked graph\n\n\n  var graph = {};\n  nodes.forEach(function (node) {\n    return graph[idAccessor(node)] = {\n      data: node,\n      out: [],\n      depth: -1,\n      skip: !nodeFilter(node)\n    };\n  });\n  links.forEach(function (_ref3) {\n    var source = _ref3.source,\n        target = _ref3.target;\n    var sourceId = getNodeId(source);\n    var targetId = getNodeId(target);\n    if (!graph.hasOwnProperty(sourceId)) throw \"Missing source node with id: \".concat(sourceId);\n    if (!graph.hasOwnProperty(targetId)) throw \"Missing target node with id: \".concat(targetId);\n    var sourceNode = graph[sourceId];\n    var targetNode = graph[targetId];\n    sourceNode.out.push(targetNode);\n\n    function getNodeId(node) {\n      return _typeof(node) === 'object' ? idAccessor(node) : node;\n    }\n  });\n  var foundLoops = [];\n  traverse(Object.values(graph));\n  var nodeDepths = Object.assign.apply(Object, [{}].concat(_toConsumableArray(Object.entries(graph).filter(function (_ref4) {\n    var _ref5 = _slicedToArray(_ref4, 2),\n        node = _ref5[1];\n\n    return !node.skip;\n  }).map(function (_ref6) {\n    var _ref7 = _slicedToArray(_ref6, 2),\n        id = _ref7[0],\n        node = _ref7[1];\n\n    return _defineProperty({}, id, node.depth);\n  }))));\n  return nodeDepths;\n\n  function traverse(nodes) {\n    var nodeStack = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n    var currentDepth = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n\n    for (var i = 0, l = nodes.length; i < l; i++) {\n      var node = nodes[i];\n\n      if (nodeStack.indexOf(node) !== -1) {\n        var _ret = function () {\n          var loop = [].concat(_toConsumableArray(nodeStack.slice(nodeStack.indexOf(node))), [node]).map(function (d) {\n            return idAccessor(d.data);\n          });\n\n          if (!foundLoops.some(function (foundLoop) {\n            return foundLoop.length === loop.length && foundLoop.every(function (id, idx) {\n              return id === loop[idx];\n            });\n          })) {\n            foundLoops.push(loop);\n            onLoopError(loop);\n          }\n\n          return \"continue\";\n        }();\n\n        if (_ret === \"continue\") continue;\n      }\n\n      if (currentDepth > node.depth) {\n        // Don't unnecessarily revisit chunks of the graph\n        node.depth = currentDepth;\n        traverse(node.out, [].concat(_toConsumableArray(nodeStack), [node]), currentDepth + (node.skip ? 0 : 1));\n      }\n    }\n  }\n}\n\nvar three$1 = window.THREE ? window.THREE // Prefer consumption from global THREE, if exists\n: {\n  Group: Group,\n  Mesh: Mesh,\n  MeshLambertMaterial: MeshLambertMaterial,\n  Color: Color,\n  BufferGeometry: BufferGeometry,\n  BufferAttribute: BufferAttribute,\n  Matrix4: Matrix4,\n  Vector3: Vector3,\n  SphereBufferGeometry: SphereBufferGeometry,\n  CylinderBufferGeometry: CylinderBufferGeometry,\n  TubeBufferGeometry: TubeBufferGeometry,\n  ConeBufferGeometry: ConeBufferGeometry,\n  Line: Line,\n  LineBasicMaterial: LineBasicMaterial,\n  QuadraticBezierCurve3: QuadraticBezierCurve3,\n  CubicBezierCurve3: CubicBezierCurve3,\n  Box3: Box3\n};\nvar ngraph = {\n  graph: graph,\n  forcelayout: forcelayout\n};\nvar DAG_LEVEL_NODE_RATIO = 2; // support multiple method names for backwards threejs compatibility\n\nvar setAttributeFn = new three$1.BufferGeometry().setAttribute ? 'setAttribute' : 'addAttribute';\nvar applyMatrix4Fn = new three$1.BufferGeometry().applyMatrix4 ? 'applyMatrix4' : 'applyMatrix';\nvar ForceGraph = Kapsule({\n  props: {\n    jsonUrl: {\n      onChange: function onChange(jsonUrl, state) {\n        var _this = this;\n\n        if (jsonUrl && !state.fetchingJson) {\n          // Load data asynchronously\n          state.fetchingJson = true;\n          state.onLoading();\n          fetch(jsonUrl).then(function (r) {\n            return r.json();\n          }).then(function (json) {\n            state.fetchingJson = false;\n            state.onFinishLoading(json);\n\n            _this.graphData(json);\n          });\n        }\n      },\n      triggerUpdate: false\n    },\n    graphData: {\n      \"default\": {\n        nodes: [],\n        links: []\n      },\n      onChange: function onChange(graphData, state) {\n        state.engineRunning = false; // Pause simulation immediately\n      }\n    },\n    numDimensions: {\n      \"default\": 3,\n      onChange: function onChange(numDim, state) {\n        var chargeForce = state.d3ForceLayout.force('charge'); // Increase repulsion on 3D mode for improved spatial separation\n\n        if (chargeForce) {\n          chargeForce.strength(numDim > 2 ? -60 : -30);\n        }\n\n        if (numDim < 3) {\n          eraseDimension(state.graphData.nodes, 'z');\n        }\n\n        if (numDim < 2) {\n          eraseDimension(state.graphData.nodes, 'y');\n        }\n\n        function eraseDimension(nodes, dim) {\n          nodes.forEach(function (d) {\n            delete d[dim]; // position\n\n            delete d[\"v\".concat(dim)]; // velocity\n          });\n        }\n      }\n    },\n    dagMode: {\n      onChange: function onChange(dagMode, state) {\n        // td, bu, lr, rl, zin, zout, radialin, radialout\n        !dagMode && state.forceEngine === 'd3' && (state.graphData.nodes || []).forEach(function (n) {\n          return n.fx = n.fy = n.fz = undefined;\n        }); // unfix nodes when disabling dag mode\n      }\n    },\n    dagLevelDistance: {},\n    dagNodeFilter: {\n      \"default\": function _default(node) {\n        return true;\n      }\n    },\n    onDagError: {\n      triggerUpdate: false\n    },\n    nodeRelSize: {\n      \"default\": 4\n    },\n    // volume per val unit\n    nodeId: {\n      \"default\": 'id'\n    },\n    nodeVal: {\n      \"default\": 'val'\n    },\n    nodeResolution: {\n      \"default\": 8\n    },\n    // how many slice segments in the sphere's circumference\n    nodeColor: {\n      \"default\": 'color'\n    },\n    nodeAutoColorBy: {},\n    nodeOpacity: {\n      \"default\": 0.75\n    },\n    nodeVisibility: {\n      \"default\": true\n    },\n    nodeThreeObject: {},\n    nodeThreeObjectExtend: {\n      \"default\": false\n    },\n    linkSource: {\n      \"default\": 'source'\n    },\n    linkTarget: {\n      \"default\": 'target'\n    },\n    linkVisibility: {\n      \"default\": true\n    },\n    linkColor: {\n      \"default\": 'color'\n    },\n    linkAutoColorBy: {},\n    linkOpacity: {\n      \"default\": 0.2\n    },\n    linkWidth: {},\n    // Rounded to nearest decimal. For falsy values use dimensionless line with 1px regardless of distance.\n    linkResolution: {\n      \"default\": 6\n    },\n    // how many radial segments in each line tube's geometry\n    linkCurvature: {\n      \"default\": 0,\n      triggerUpdate: false\n    },\n    // line curvature radius (0: straight, 1: semi-circle)\n    linkCurveRotation: {\n      \"default\": 0,\n      triggerUpdate: false\n    },\n    // line curve rotation along the line axis (0: interection with XY plane, PI: upside down)\n    linkMaterial: {},\n    linkThreeObject: {},\n    linkThreeObjectExtend: {\n      \"default\": false\n    },\n    linkPositionUpdate: {\n      triggerUpdate: false\n    },\n    // custom function to call for updating the link's position. Signature: (threeObj, { start: { x, y, z},  end: { x, y, z }}, link). If the function returns a truthy value, the regular link position update will not run.\n    linkDirectionalArrowLength: {\n      \"default\": 0\n    },\n    linkDirectionalArrowColor: {},\n    linkDirectionalArrowRelPos: {\n      \"default\": 0.5,\n      triggerUpdate: false\n    },\n    // value between 0<>1 indicating the relative pos along the (exposed) line\n    linkDirectionalArrowResolution: {\n      \"default\": 8\n    },\n    // how many slice segments in the arrow's conic circumference\n    linkDirectionalParticles: {\n      \"default\": 0\n    },\n    // animate photons travelling in the link direction\n    linkDirectionalParticleSpeed: {\n      \"default\": 0.01,\n      triggerUpdate: false\n    },\n    // in link length ratio per frame\n    linkDirectionalParticleWidth: {\n      \"default\": 0.5\n    },\n    linkDirectionalParticleColor: {},\n    linkDirectionalParticleResolution: {\n      \"default\": 4\n    },\n    // how many slice segments in the particle sphere's circumference\n    forceEngine: {\n      \"default\": 'd3'\n    },\n    // d3 or ngraph\n    d3AlphaMin: {\n      \"default\": 0,\n      triggerUpdate: false\n    },\n    d3AlphaDecay: {\n      \"default\": 0.0228,\n      triggerUpdate: false,\n      onChange: function onChange(alphaDecay, state) {\n        state.d3ForceLayout.alphaDecay(alphaDecay);\n      }\n    },\n    d3AlphaTarget: {\n      \"default\": 0,\n      triggerUpdate: false,\n      onChange: function onChange(alphaTarget, state) {\n        state.d3ForceLayout.alphaTarget(alphaTarget);\n      }\n    },\n    d3VelocityDecay: {\n      \"default\": 0.4,\n      triggerUpdate: false,\n      onChange: function onChange(velocityDecay, state) {\n        state.d3ForceLayout.velocityDecay(velocityDecay);\n      }\n    },\n    ngraphPhysics: {\n      \"default\": {\n        // defaults from https://github.com/anvaka/ngraph.physics.simulator/blob/master/index.js\n        timeStep: 20,\n        gravity: -1.2,\n        theta: 0.8,\n        springLength: 30,\n        springCoefficient: 0.0008,\n        dragCoefficient: 0.02\n      }\n    },\n    warmupTicks: {\n      \"default\": 0,\n      triggerUpdate: false\n    },\n    // how many times to tick the force engine at init before starting to render\n    cooldownTicks: {\n      \"default\": Infinity,\n      triggerUpdate: false\n    },\n    cooldownTime: {\n      \"default\": 15000,\n      triggerUpdate: false\n    },\n    // ms\n    onLoading: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onFinishLoading: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onUpdate: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onFinishUpdate: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onEngineTick: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onEngineStop: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    }\n  },\n  methods: {\n    refresh: function refresh(state) {\n      state._flushObjects = true;\n\n      state._rerender();\n\n      return this;\n    },\n    // Expose d3 forces for external manipulation\n    d3Force: function d3Force(state, forceName, forceFn) {\n      if (forceFn === undefined) {\n        return state.d3ForceLayout.force(forceName); // Force getter\n      }\n\n      state.d3ForceLayout.force(forceName, forceFn); // Force setter\n\n      return this;\n    },\n    d3ReheatSimulation: function d3ReheatSimulation(state) {\n      state.d3ForceLayout.alpha(1);\n      this.resetCountdown();\n      return this;\n    },\n    // reset cooldown state\n    resetCountdown: function resetCountdown(state) {\n      state.cntTicks = 0;\n      state.startTickTime = new Date();\n      state.engineRunning = true;\n      return this;\n    },\n    tickFrame: function tickFrame(state) {\n      var isD3Sim = state.forceEngine !== 'ngraph';\n\n      if (state.engineRunning) {\n        layoutTick();\n      }\n\n      updateArrows();\n      updatePhotons();\n      return this; //\n\n      function layoutTick() {\n        if (++state.cntTicks > state.cooldownTicks || new Date() - state.startTickTime > state.cooldownTime || isD3Sim && state.d3AlphaMin > 0 && state.d3ForceLayout.alpha() < state.d3AlphaMin) {\n          state.engineRunning = false; // Stop ticking graph\n\n          state.onEngineStop();\n        } else {\n          state.layout[isD3Sim ? 'tick' : 'step'](); // Tick it\n\n          state.onEngineTick();\n        } // Update nodes position\n\n\n        state.graphData.nodes.forEach(function (node) {\n          var obj = node.__threeObj;\n          if (!obj) return;\n          var pos = isD3Sim ? node : state.layout.getNodePosition(node[state.nodeId]);\n          obj.position.x = pos.x;\n          obj.position.y = pos.y || 0;\n          obj.position.z = pos.z || 0;\n        }); // Update links position\n\n        var linkWidthAccessor = accessorFn(state.linkWidth);\n        var linkCurvatureAccessor = accessorFn(state.linkCurvature);\n        var linkCurveRotationAccessor = accessorFn(state.linkCurveRotation);\n        var linkThreeObjectExtendAccessor = accessorFn(state.linkThreeObjectExtend);\n        state.graphData.links.forEach(function (link) {\n          var lineObj = link.__lineObj;\n          if (!lineObj) return;\n          var pos = isD3Sim ? link : state.layout.getLinkPosition(state.layout.graph.getLink(link.source, link.target).id);\n          var start = pos[isD3Sim ? 'source' : 'from'];\n          var end = pos[isD3Sim ? 'target' : 'to'];\n          if (!start || !end || !start.hasOwnProperty('x') || !end.hasOwnProperty('x')) return; // skip invalid link\n\n          calcLinkCurve(link); // calculate link curve for all links, including custom replaced, so it can be used in directional functionality\n\n          var extendedObj = linkThreeObjectExtendAccessor(link);\n\n          if (state.linkPositionUpdate && state.linkPositionUpdate(extendedObj ? lineObj.children[1] : lineObj, // pass child custom object if extending the default\n          {\n            start: {\n              x: start.x,\n              y: start.y,\n              z: start.z\n            },\n            end: {\n              x: end.x,\n              y: end.y,\n              z: end.z\n            }\n          }, link) && !extendedObj) {\n            // exit if successfully custom updated position of non-extended obj\n            return;\n          }\n\n          var curveResolution = 30; // # line segments\n\n          var curve = link.__curve; // select default line obj if it's an extended group\n\n          var line = lineObj.children.length ? lineObj.children[0] : lineObj;\n\n          if (line.type === 'Line') {\n            // Update line geometry\n            if (!curve) {\n              // straight line\n              var linePos = line.geometry.getAttribute('position');\n\n              if (!linePos || !linePos.array || linePos.array.length !== 6) {\n                line.geometry[setAttributeFn]('position', linePos = new three$1.BufferAttribute(new Float32Array(2 * 3), 3));\n              }\n\n              linePos.array[0] = start.x;\n              linePos.array[1] = start.y || 0;\n              linePos.array[2] = start.z || 0;\n              linePos.array[3] = end.x;\n              linePos.array[4] = end.y || 0;\n              linePos.array[5] = end.z || 0;\n              linePos.needsUpdate = true;\n            } else {\n              // bezier curve line\n              line.geometry.setFromPoints(curve.getPoints(curveResolution));\n            }\n\n            line.geometry.computeBoundingSphere();\n          } else if (line.type === 'Mesh') {\n            // Update cylinder geometry\n            if (!curve) {\n              // straight tube\n              if (!line.geometry.type.match(/^Cylinder(Buffer)?Geometry$/)) {\n                var linkWidth = Math.ceil(linkWidthAccessor(link) * 10) / 10;\n                var r = linkWidth / 2;\n                var geometry = new three$1.CylinderBufferGeometry(r, r, 1, state.linkResolution, 1, false);\n                geometry[applyMatrix4Fn](new three$1.Matrix4().makeTranslation(0, 1 / 2, 0));\n                geometry[applyMatrix4Fn](new three$1.Matrix4().makeRotationX(Math.PI / 2));\n                line.geometry.dispose();\n                line.geometry = geometry;\n              }\n\n              var vStart = new three$1.Vector3(start.x, start.y || 0, start.z || 0);\n              var vEnd = new three$1.Vector3(end.x, end.y || 0, end.z || 0);\n              var distance = vStart.distanceTo(vEnd);\n              line.position.x = vStart.x;\n              line.position.y = vStart.y;\n              line.position.z = vStart.z;\n              line.scale.z = distance;\n              line.parent.localToWorld(vEnd); // lookAt requires world coords\n\n              line.lookAt(vEnd);\n            } else {\n              // curved tube\n              if (!line.geometry.type.match(/^Tube(Buffer)?Geometry$/)) {\n                // reset object positioning\n                line.position.set(0, 0, 0);\n                line.rotation.set(0, 0, 0);\n                line.scale.set(1, 1, 1);\n              }\n\n              var _linkWidth = Math.ceil(linkWidthAccessor(link) * 10) / 10;\n\n              var _r = _linkWidth / 2;\n\n              var _geometry = new three$1.TubeBufferGeometry(curve, curveResolution, _r, state.linkResolution, false);\n\n              line.geometry.dispose();\n              line.geometry = _geometry;\n            }\n          }\n        }); //\n\n        function calcLinkCurve(link) {\n          var pos = isD3Sim ? link : state.layout.getLinkPosition(state.layout.graph.getLink(link.source, link.target).id);\n          var start = pos[isD3Sim ? 'source' : 'from'];\n          var end = pos[isD3Sim ? 'target' : 'to'];\n          if (!start || !end || !start.hasOwnProperty('x') || !end.hasOwnProperty('x')) return; // skip invalid link\n\n          var curvature = linkCurvatureAccessor(link);\n\n          if (!curvature) {\n            link.__curve = null; // Straight line\n          } else {\n            // bezier curve line (only for line types)\n            var vStart = new three$1.Vector3(start.x, start.y || 0, start.z || 0);\n            var vEnd = new three$1.Vector3(end.x, end.y || 0, end.z || 0);\n            var l = vStart.distanceTo(vEnd); // line length\n\n            var curve;\n            var curveRotation = linkCurveRotationAccessor(link);\n\n            if (l > 0) {\n              var dx = end.x - start.x;\n              var dy = end.y - start.y || 0;\n              var vLine = new three$1.Vector3().subVectors(vEnd, vStart);\n              var cp = vLine.clone().multiplyScalar(curvature).cross(dx !== 0 || dy !== 0 ? new three$1.Vector3(0, 0, 1) : new three$1.Vector3(0, 1, 0)) // avoid cross-product of parallel vectors (prefer Z, fallback to Y)\n              .applyAxisAngle(vLine.normalize(), curveRotation) // rotate along line axis according to linkCurveRotation\n              .add(new three$1.Vector3().addVectors(vStart, vEnd).divideScalar(2));\n              curve = new three$1.QuadraticBezierCurve3(vStart, cp, vEnd);\n            } else {\n              // Same point, draw a loop\n              var d = curvature * 70;\n              var endAngle = -curveRotation; // Rotate clockwise (from Z angle perspective)\n\n              var startAngle = endAngle + Math.PI / 2;\n              curve = new three$1.CubicBezierCurve3(vStart, new three$1.Vector3(d * Math.cos(startAngle), d * Math.sin(startAngle), 0).add(vStart), new three$1.Vector3(d * Math.cos(endAngle), d * Math.sin(endAngle), 0).add(vStart), vEnd);\n            }\n\n            link.__curve = curve;\n          }\n        }\n      }\n\n      function updateArrows() {\n        // update link arrow position\n        var arrowRelPosAccessor = accessorFn(state.linkDirectionalArrowRelPos);\n        var arrowLengthAccessor = accessorFn(state.linkDirectionalArrowLength);\n        var nodeValAccessor = accessorFn(state.nodeVal);\n        state.graphData.links.forEach(function (link) {\n          var arrowObj = link.__arrowObj;\n          if (!arrowObj) return;\n          var pos = isD3Sim ? link : state.layout.getLinkPosition(state.layout.graph.getLink(link.source, link.target).id);\n          var start = pos[isD3Sim ? 'source' : 'from'];\n          var end = pos[isD3Sim ? 'target' : 'to'];\n          if (!start || !end || !start.hasOwnProperty('x') || !end.hasOwnProperty('x')) return; // skip invalid link\n\n          var startR = Math.sqrt(Math.max(0, nodeValAccessor(start) || 1)) * state.nodeRelSize;\n          var endR = Math.sqrt(Math.max(0, nodeValAccessor(end) || 1)) * state.nodeRelSize;\n          var arrowLength = arrowLengthAccessor(link);\n          var arrowRelPos = arrowRelPosAccessor(link);\n          var getPosAlongLine = link.__curve ? function (t) {\n            return link.__curve.getPoint(t);\n          } // interpolate along bezier curve\n          : function (t) {\n            // straight line: interpolate linearly\n            var iplt = function iplt(dim, start, end, t) {\n              return start[dim] + (end[dim] - start[dim]) * t || 0;\n            };\n\n            return {\n              x: iplt('x', start, end, t),\n              y: iplt('y', start, end, t),\n              z: iplt('z', start, end, t)\n            };\n          };\n          var lineLen = link.__curve ? link.__curve.getLength() : Math.sqrt(['x', 'y', 'z'].map(function (dim) {\n            return Math.pow((end[dim] || 0) - (start[dim] || 0), 2);\n          }).reduce(function (acc, v) {\n            return acc + v;\n          }, 0));\n          var posAlongLine = startR + arrowLength + (lineLen - startR - endR - arrowLength) * arrowRelPos;\n          var arrowHead = getPosAlongLine(posAlongLine / lineLen);\n          var arrowTail = getPosAlongLine((posAlongLine - arrowLength) / lineLen);\n          ['x', 'y', 'z'].forEach(function (dim) {\n            return arrowObj.position[dim] = arrowTail[dim];\n          });\n\n          var headVec = _construct(three$1.Vector3, _toConsumableArray(['x', 'y', 'z'].map(function (c) {\n            return arrowHead[c];\n          })));\n\n          arrowObj.parent.localToWorld(headVec); // lookAt requires world coords\n\n          arrowObj.lookAt(headVec);\n        });\n      }\n\n      function updatePhotons() {\n        // update link particle positions\n        var particleSpeedAccessor = accessorFn(state.linkDirectionalParticleSpeed);\n        state.graphData.links.forEach(function (link) {\n          var cyclePhotons = link.__photonsObj && link.__photonsObj.children;\n          var singleHopPhotons = link.__singleHopPhotonsObj && link.__singleHopPhotonsObj.children;\n          if ((!singleHopPhotons || !singleHopPhotons.length) && (!cyclePhotons || !cyclePhotons.length)) return;\n          var pos = isD3Sim ? link : state.layout.getLinkPosition(state.layout.graph.getLink(link.source, link.target).id);\n          var start = pos[isD3Sim ? 'source' : 'from'];\n          var end = pos[isD3Sim ? 'target' : 'to'];\n          if (!start || !end || !start.hasOwnProperty('x') || !end.hasOwnProperty('x')) return; // skip invalid link\n\n          var particleSpeed = particleSpeedAccessor(link);\n          var getPhotonPos = link.__curve ? function (t) {\n            return link.__curve.getPoint(t);\n          } // interpolate along bezier curve\n          : function (t) {\n            // straight line: interpolate linearly\n            var iplt = function iplt(dim, start, end, t) {\n              return start[dim] + (end[dim] - start[dim]) * t || 0;\n            };\n\n            return {\n              x: iplt('x', start, end, t),\n              y: iplt('y', start, end, t),\n              z: iplt('z', start, end, t)\n            };\n          };\n          var photons = [].concat(_toConsumableArray(cyclePhotons || []), _toConsumableArray(singleHopPhotons || []));\n          photons.forEach(function (photon, idx) {\n            var singleHop = photon.parent.__linkThreeObjType === 'singleHopPhotons';\n\n            if (!photon.hasOwnProperty('__progressRatio')) {\n              photon.__progressRatio = singleHop ? 0 : idx / cyclePhotons.length;\n            }\n\n            photon.__progressRatio += particleSpeed;\n\n            if (photon.__progressRatio >= 1) {\n              if (!singleHop) {\n                photon.__progressRatio = photon.__progressRatio % 1;\n              } else {\n                // remove particle\n                photon.parent.remove(photon);\n                emptyObject(photon);\n                return;\n              }\n            }\n\n            var photonPosRatio = photon.__progressRatio;\n            var pos = getPhotonPos(photonPosRatio);\n            ['x', 'y', 'z'].forEach(function (dim) {\n              return photon.position[dim] = pos[dim];\n            });\n          });\n        });\n      }\n    },\n    emitParticle: function emitParticle(state, link) {\n      if (link) {\n        if (!link.__singleHopPhotonsObj) {\n          var obj = new three$1.Group();\n          obj.__linkThreeObjType = 'singleHopPhotons';\n          link.__singleHopPhotonsObj = obj;\n          state.graphScene.add(obj);\n        }\n\n        var particleWidthAccessor = accessorFn(state.linkDirectionalParticleWidth);\n        var photonR = Math.ceil(particleWidthAccessor(link) * 10) / 10 / 2;\n        var numSegments = state.linkDirectionalParticleResolution;\n        var particleGeometry = new three$1.SphereBufferGeometry(photonR, numSegments, numSegments);\n        var linkColorAccessor = accessorFn(state.linkColor);\n        var particleColorAccessor = accessorFn(state.linkDirectionalParticleColor);\n        var photonColor = particleColorAccessor(link) || linkColorAccessor(link) || '#f0f0f0';\n        var materialColor = new three$1.Color(colorStr2Hex(photonColor));\n        var opacity = state.linkOpacity * 3;\n        var particleMaterial = new three$1.MeshLambertMaterial({\n          color: materialColor,\n          transparent: true,\n          opacity: opacity\n        }); // add a single hop particle\n\n        link.__singleHopPhotonsObj.add(new three$1.Mesh(particleGeometry, particleMaterial));\n      }\n\n      return this;\n    },\n    getGraphBbox: function getGraphBbox(state) {\n      var nodeFilter = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : function () {\n        return true;\n      };\n      if (!state.initialised) return null; // recursively collect all nested geometries bboxes\n\n      var bboxes = function getBboxes(obj) {\n        var bboxes = [];\n\n        if (obj.geometry) {\n          obj.geometry.computeBoundingBox();\n          var box = new three$1.Box3();\n          box.copy(obj.geometry.boundingBox).applyMatrix4(obj.matrixWorld);\n          bboxes.push(box);\n        }\n\n        return bboxes.concat.apply(bboxes, _toConsumableArray((obj.children || []).filter(function (obj) {\n          return !obj.hasOwnProperty('__graphObjType') || obj.__graphObjType === 'node' && nodeFilter(obj.__data);\n        } // exclude filtered out nodes\n        ).map(getBboxes)));\n      }(state.graphScene);\n\n      if (!bboxes.length) return null; // extract global x,y,z min/max\n\n      return Object.assign.apply(Object, _toConsumableArray(['x', 'y', 'z'].map(function (c) {\n        return _defineProperty({}, c, [min(bboxes, function (bb) {\n          return bb.min[c];\n        }), max(bboxes, function (bb) {\n          return bb.max[c];\n        })]);\n      })));\n    }\n  },\n  stateInit: function stateInit() {\n    return {\n      d3ForceLayout: forceSimulation().force('link', forceLink()).force('charge', forceManyBody()).force('center', forceCenter()).force('dagRadial', null).stop(),\n      engineRunning: false\n    };\n  },\n  init: function init(threeObj, state) {\n    // Main three object to manipulate\n    state.graphScene = threeObj;\n  },\n  update: function update(state, changedProps) {\n    var hasAnyPropChanged = function hasAnyPropChanged(propList) {\n      return propList.some(function (p) {\n        return changedProps.hasOwnProperty(p);\n      });\n    };\n\n    state.engineRunning = false; // pause simulation\n\n    state.onUpdate();\n\n    if (state.nodeAutoColorBy !== null && hasAnyPropChanged(['nodeAutoColorBy', 'graphData', 'nodeColor'])) {\n      // Auto add color to uncolored nodes\n      autoColorObjects(state.graphData.nodes, accessorFn(state.nodeAutoColorBy), state.nodeColor);\n    }\n\n    if (state.linkAutoColorBy !== null && hasAnyPropChanged(['linkAutoColorBy', 'graphData', 'linkColor'])) {\n      // Auto add color to uncolored links\n      autoColorObjects(state.graphData.links, accessorFn(state.linkAutoColorBy), state.linkColor);\n    } // Digest nodes WebGL objects\n\n\n    if (state._flushObjects || hasAnyPropChanged(['graphData', 'nodeThreeObject', 'nodeThreeObjectExtend', 'nodeVal', 'nodeColor', 'nodeVisibility', 'nodeRelSize', 'nodeResolution', 'nodeOpacity'])) {\n      var customObjectAccessor = accessorFn(state.nodeThreeObject);\n      var customObjectExtendAccessor = accessorFn(state.nodeThreeObjectExtend);\n      var valAccessor = accessorFn(state.nodeVal);\n      var colorAccessor = accessorFn(state.nodeColor);\n      var visibilityAccessor = accessorFn(state.nodeVisibility);\n      var sphereGeometries = {}; // indexed by node value\n\n      var sphereMaterials = {}; // indexed by color\n\n      threeDigest(state.graphData.nodes.filter(visibilityAccessor), state.graphScene, {\n        purge: state._flushObjects || hasAnyPropChanged([// recreate objects if any of these props have changed\n        'nodeThreeObject', 'nodeThreeObjectExtend']),\n        objFilter: function objFilter(obj) {\n          return obj.__graphObjType === 'node';\n        },\n        createObj: function createObj(node) {\n          var customObj = customObjectAccessor(node);\n          var extendObj = customObjectExtendAccessor(node);\n\n          if (customObj && state.nodeThreeObject === customObj) {\n            // clone object if it's a shared object among all nodes\n            customObj = customObj.clone();\n          }\n\n          var obj;\n\n          if (customObj && !extendObj) {\n            obj = customObj;\n          } else {\n            // Add default object (sphere mesh)\n            obj = new three$1.Mesh();\n            obj.__graphDefaultObj = true;\n\n            if (customObj && extendObj) {\n              obj.add(customObj); // extend default with custom\n            }\n          }\n\n          obj.__graphObjType = 'node'; // Add object type\n\n          return obj;\n        },\n        updateObj: function updateObj(obj, node) {\n          if (obj.__graphDefaultObj) {\n            // bypass internal updates for custom node objects\n            var val = valAccessor(node) || 1;\n            var radius = Math.cbrt(val) * state.nodeRelSize;\n            var numSegments = state.nodeResolution;\n\n            if (!obj.geometry.type.match(/^Sphere(Buffer)?Geometry$/) || obj.geometry.parameters.radius !== radius || obj.geometry.parameters.widthSegments !== numSegments) {\n              if (!sphereGeometries.hasOwnProperty(val)) {\n                sphereGeometries[val] = new three$1.SphereBufferGeometry(radius, numSegments, numSegments);\n              }\n\n              obj.geometry.dispose();\n              obj.geometry = sphereGeometries[val];\n            }\n\n            var color = colorAccessor(node);\n            var materialColor = new three$1.Color(colorStr2Hex(color || '#ffffaa'));\n            var opacity = state.nodeOpacity * colorAlpha(color);\n\n            if (obj.material.type !== 'MeshLambertMaterial' || !obj.material.color.equals(materialColor) || obj.material.opacity !== opacity) {\n              if (!sphereMaterials.hasOwnProperty(color)) {\n                sphereMaterials[color] = new three$1.MeshLambertMaterial({\n                  color: materialColor,\n                  transparent: true,\n                  opacity: opacity\n                });\n              }\n\n              obj.material.dispose();\n              obj.material = sphereMaterials[color];\n            }\n          }\n        }\n      });\n    } // Digest links WebGL objects\n\n\n    if (state._flushObjects || hasAnyPropChanged(['graphData', 'linkThreeObject', 'linkThreeObjectExtend', 'linkMaterial', 'linkColor', 'linkWidth', 'linkVisibility', 'linkResolution', 'linkOpacity', 'linkDirectionalArrowLength', 'linkDirectionalArrowColor', 'linkDirectionalArrowResolution', 'linkDirectionalParticles', 'linkDirectionalParticleWidth', 'linkDirectionalParticleColor', 'linkDirectionalParticleResolution'])) {\n      var _customObjectAccessor = accessorFn(state.linkThreeObject);\n\n      var _customObjectExtendAccessor = accessorFn(state.linkThreeObjectExtend);\n\n      var customMaterialAccessor = accessorFn(state.linkMaterial);\n\n      var _visibilityAccessor = accessorFn(state.linkVisibility);\n\n      var _colorAccessor = accessorFn(state.linkColor);\n\n      var widthAccessor = accessorFn(state.linkWidth);\n      var cylinderGeometries = {}; // indexed by link width\n\n      var lambertLineMaterials = {}; // for cylinder objects, indexed by link color\n\n      var basicLineMaterials = {}; // for line objects, indexed by link color\n\n      var visibleLinks = state.graphData.links.filter(_visibilityAccessor); // lines digest cycle\n\n      threeDigest(visibleLinks, state.graphScene, {\n        objBindAttr: '__lineObj',\n        purge: state._flushObjects || hasAnyPropChanged([// recreate objects if any of these props have changed\n        'linkThreeObject', 'linkThreeObjectExtend', 'linkWidth']),\n        objFilter: function objFilter(obj) {\n          return obj.__graphObjType === 'link';\n        },\n        createObj: function createObj(link) {\n          var customObj = _customObjectAccessor(link);\n\n          var extendObj = _customObjectExtendAccessor(link);\n\n          if (customObj && state.linkThreeObject === customObj) {\n            // clone object if it's a shared object among all links\n            customObj = customObj.clone();\n          }\n\n          var defaultObj;\n\n          if (!customObj || extendObj) {\n            // construct default line obj\n            var useCylinder = !!widthAccessor(link);\n\n            if (useCylinder) {\n              defaultObj = new three$1.Mesh();\n            } else {\n              // Use plain line (constant width)\n              var lineGeometry = new three$1.BufferGeometry();\n              lineGeometry[setAttributeFn]('position', new three$1.BufferAttribute(new Float32Array(2 * 3), 3));\n              defaultObj = new three$1.Line(lineGeometry);\n            }\n          }\n\n          var obj;\n\n          if (!customObj) {\n            obj = defaultObj;\n            obj.__graphDefaultObj = true;\n          } else {\n            if (!extendObj) {\n              // use custom object\n              obj = customObj;\n            } else {\n              // extend default with custom in a group\n              obj = new three$1.Group();\n              obj.__graphDefaultObj = true;\n              obj.add(defaultObj);\n              obj.add(customObj);\n            }\n          }\n\n          obj.renderOrder = 10; // Prevent visual glitches of dark lines on top of nodes by rendering them last\n\n          obj.__graphObjType = 'link'; // Add object type\n\n          return obj;\n        },\n        updateObj: function updateObj(updObj, link) {\n          if (updObj.__graphDefaultObj) {\n            // bypass internal updates for custom link objects\n            // select default object if it's an extended group\n            var obj = updObj.children.length ? updObj.children[0] : updObj;\n            var linkWidth = Math.ceil(widthAccessor(link) * 10) / 10;\n            var useCylinder = !!linkWidth;\n\n            if (useCylinder) {\n              var r = linkWidth / 2;\n              var numSegments = state.linkResolution;\n\n              if (!obj.geometry.type.match(/^Cylinder(Buffer)?Geometry$/) || obj.geometry.parameters.radiusTop !== r || obj.geometry.parameters.radialSegments !== numSegments) {\n                if (!cylinderGeometries.hasOwnProperty(linkWidth)) {\n                  var geometry = new three$1.CylinderBufferGeometry(r, r, 1, numSegments, 1, false);\n                  geometry[applyMatrix4Fn](new three$1.Matrix4().makeTranslation(0, 1 / 2, 0));\n                  geometry[applyMatrix4Fn](new three$1.Matrix4().makeRotationX(Math.PI / 2));\n                  cylinderGeometries[linkWidth] = geometry;\n                }\n\n                obj.geometry.dispose();\n                obj.geometry = cylinderGeometries[linkWidth];\n              }\n            }\n\n            var customMaterial = customMaterialAccessor(link);\n\n            if (customMaterial) {\n              obj.material = customMaterial;\n            } else {\n              var color = _colorAccessor(link);\n\n              var materialColor = new three$1.Color(colorStr2Hex(color || '#f0f0f0'));\n              var opacity = state.linkOpacity * colorAlpha(color);\n              var materialType = useCylinder ? 'MeshLambertMaterial' : 'LineBasicMaterial';\n\n              if (obj.material.type !== materialType || !obj.material.color.equals(materialColor) || obj.material.opacity !== opacity) {\n                var lineMaterials = useCylinder ? lambertLineMaterials : basicLineMaterials;\n\n                if (!lineMaterials.hasOwnProperty(color)) {\n                  lineMaterials[color] = new three$1[materialType]({\n                    color: materialColor,\n                    transparent: opacity < 1,\n                    opacity: opacity,\n                    depthWrite: opacity >= 1 // Prevent transparency issues\n\n                  });\n                }\n\n                obj.material.dispose();\n                obj.material = lineMaterials[color];\n              }\n            }\n          }\n        }\n      }); // Arrows digest cycle\n\n      if (state.linkDirectionalArrowLength || changedProps.hasOwnProperty('linkDirectionalArrowLength')) {\n        var arrowLengthAccessor = accessorFn(state.linkDirectionalArrowLength);\n        var arrowColorAccessor = accessorFn(state.linkDirectionalArrowColor);\n        threeDigest(visibleLinks.filter(arrowLengthAccessor), state.graphScene, {\n          objBindAttr: '__arrowObj',\n          objFilter: function objFilter(obj) {\n            return obj.__linkThreeObjType === 'arrow';\n          },\n          createObj: function createObj() {\n            var obj = new three$1.Mesh(undefined, new three$1.MeshLambertMaterial({\n              transparent: true\n            }));\n            obj.__linkThreeObjType = 'arrow'; // Add object type\n\n            return obj;\n          },\n          updateObj: function updateObj(obj, link) {\n            var arrowLength = arrowLengthAccessor(link);\n            var numSegments = state.linkDirectionalArrowResolution;\n\n            if (!obj.geometry.type.match(/^Cone(Buffer)?Geometry$/) || obj.geometry.parameters.height !== arrowLength || obj.geometry.parameters.radialSegments !== numSegments) {\n              var coneGeometry = new three$1.ConeBufferGeometry(arrowLength * 0.25, arrowLength, numSegments); // Correct orientation\n\n              coneGeometry.translate(0, arrowLength / 2, 0);\n              coneGeometry.rotateX(Math.PI / 2);\n              obj.geometry.dispose();\n              obj.geometry = coneGeometry;\n            }\n\n            obj.material.color = new three$1.Color(arrowColorAccessor(link) || _colorAccessor(link) || '#f0f0f0');\n            obj.material.opacity = state.linkOpacity * 3;\n          }\n        });\n      } // Photon particles digest cycle\n\n\n      if (state.linkDirectionalParticles || changedProps.hasOwnProperty('linkDirectionalParticles')) {\n        var particlesAccessor = accessorFn(state.linkDirectionalParticles);\n        var particleWidthAccessor = accessorFn(state.linkDirectionalParticleWidth);\n        var particleColorAccessor = accessorFn(state.linkDirectionalParticleColor);\n        var particleMaterials = {}; // indexed by link color\n\n        var particleGeometries = {}; // indexed by particle width\n\n        threeDigest(visibleLinks.filter(particlesAccessor), state.graphScene, {\n          objBindAttr: '__photonsObj',\n          objFilter: function objFilter(obj) {\n            return obj.__linkThreeObjType === 'photons';\n          },\n          createObj: function createObj() {\n            var obj = new three$1.Group();\n            obj.__linkThreeObjType = 'photons'; // Add object type\n\n            return obj;\n          },\n          updateObj: function updateObj(obj, link) {\n            var numPhotons = Math.round(Math.abs(particlesAccessor(link)));\n            var curPhoton = !!obj.children.length && obj.children[0];\n            var photonR = Math.ceil(particleWidthAccessor(link) * 10) / 10 / 2;\n            var numSegments = state.linkDirectionalParticleResolution;\n            var particleGeometry;\n\n            if (curPhoton && curPhoton.geometry.parameters.radius === photonR && curPhoton.geometry.parameters.widthSegments === numSegments) {\n              particleGeometry = curPhoton.geometry;\n            } else {\n              if (!particleGeometries.hasOwnProperty(photonR)) {\n                particleGeometries[photonR] = new three$1.SphereBufferGeometry(photonR, numSegments, numSegments);\n              }\n\n              particleGeometry = particleGeometries[photonR];\n              curPhoton && curPhoton.geometry.dispose();\n            }\n\n            var photonColor = particleColorAccessor(link) || _colorAccessor(link) || '#f0f0f0';\n            var materialColor = new three$1.Color(colorStr2Hex(photonColor));\n            var opacity = state.linkOpacity * 3;\n            var particleMaterial;\n\n            if (curPhoton && curPhoton.material.color.equals(materialColor) && curPhoton.material.opacity === opacity) {\n              particleMaterial = curPhoton.material;\n            } else {\n              if (!particleMaterials.hasOwnProperty(photonColor)) {\n                particleMaterials[photonColor] = new three$1.MeshLambertMaterial({\n                  color: materialColor,\n                  transparent: true,\n                  opacity: opacity\n                });\n              }\n\n              particleMaterial = particleMaterials[photonColor];\n              curPhoton && curPhoton.material.dispose();\n            } // digest cycle for each photon\n\n\n            threeDigest(_toConsumableArray(new Array(numPhotons)).map(function (_, idx) {\n              return {\n                idx: idx\n              };\n            }), obj, {\n              idAccessor: function idAccessor(d) {\n                return d.idx;\n              },\n              createObj: function createObj() {\n                return new three$1.Mesh(particleGeometry, particleMaterial);\n              },\n              updateObj: function updateObj(obj) {\n                obj.geometry = particleGeometry;\n                obj.material = particleMaterial;\n              }\n            });\n          }\n        });\n      }\n    }\n\n    state._flushObjects = false; // reset objects refresh flag\n    // simulation engine\n\n    if (hasAnyPropChanged(['graphData', 'nodeId', 'linkSource', 'linkTarget', 'numDimensions', 'forceEngine', 'dagMode', 'dagNodeFilter', 'dagLevelDistance'])) {\n      state.engineRunning = false; // Pause simulation\n      // parse links\n\n      state.graphData.links.forEach(function (link) {\n        link.source = link[state.linkSource];\n        link.target = link[state.linkTarget];\n      }); // Feed data to force-directed layout\n\n      var isD3Sim = state.forceEngine !== 'ngraph';\n      var layout;\n\n      if (isD3Sim) {\n        // D3-force\n        (layout = state.d3ForceLayout).stop().alpha(1) // re-heat the simulation\n        .numDimensions(state.numDimensions).nodes(state.graphData.nodes); // add links (if link force is still active)\n\n        var linkForce = state.d3ForceLayout.force('link');\n\n        if (linkForce) {\n          linkForce.id(function (d) {\n            return d[state.nodeId];\n          }).links(state.graphData.links);\n        } // setup dag force constraints\n\n\n        var nodeDepths = state.dagMode && getDagDepths(state.graphData, function (node) {\n          return node[state.nodeId];\n        }, {\n          nodeFilter: state.dagNodeFilter,\n          onLoopError: state.onDagError || undefined\n        });\n        var maxDepth = Math.max.apply(Math, _toConsumableArray(Object.values(nodeDepths || [])));\n        var dagLevelDistance = state.dagLevelDistance || state.graphData.nodes.length / (maxDepth || 1) * DAG_LEVEL_NODE_RATIO * (['radialin', 'radialout'].indexOf(state.dagMode) !== -1 ? 0.7 : 1); // Fix nodes to x,y,z for dag mode\n\n        if (state.dagMode) {\n          var getFFn = function getFFn(fix, invert) {\n            return function (node) {\n              return !fix ? undefined : (nodeDepths[node[state.nodeId]] - maxDepth / 2) * dagLevelDistance * (invert ? -1 : 1);\n            };\n          };\n\n          var fxFn = getFFn(['lr', 'rl'].indexOf(state.dagMode) !== -1, state.dagMode === 'rl');\n          var fyFn = getFFn(['td', 'bu'].indexOf(state.dagMode) !== -1, state.dagMode === 'td');\n          var fzFn = getFFn(['zin', 'zout'].indexOf(state.dagMode) !== -1, state.dagMode === 'zout');\n          state.graphData.nodes.filter(state.dagNodeFilter).forEach(function (node) {\n            node.fx = fxFn(node);\n            node.fy = fyFn(node);\n            node.fz = fzFn(node);\n          });\n        } // Use radial force for radial dags\n\n\n        state.d3ForceLayout.force('dagRadial', ['radialin', 'radialout'].indexOf(state.dagMode) !== -1 ? forceRadial(function (node) {\n          var nodeDepth = nodeDepths[node[state.nodeId]] || -1;\n          return (state.dagMode === 'radialin' ? maxDepth - nodeDepth : nodeDepth) * dagLevelDistance;\n        }).strength(function (node) {\n          return state.dagNodeFilter(node) ? 1 : 0;\n        }) : null);\n      } else {\n        // ngraph\n        var _graph = ngraph.graph();\n\n        state.graphData.nodes.forEach(function (node) {\n          _graph.addNode(node[state.nodeId]);\n        });\n        state.graphData.links.forEach(function (link) {\n          _graph.addLink(link.source, link.target);\n        });\n        layout = ngraph.forcelayout(_graph, _objectSpread2({\n          dimensions: state.numDimensions\n        }, state.ngraphPhysics));\n        layout.graph = _graph; // Attach graph reference to layout\n      }\n\n      for (var i = 0; i < state.warmupTicks && !(isD3Sim && state.d3AlphaMin > 0 && state.d3ForceLayout.alpha() < state.d3AlphaMin); i++) {\n        layout[isD3Sim ? \"tick\" : \"step\"]();\n      } // Initial ticks before starting to render\n\n\n      state.layout = layout;\n      this.resetCountdown();\n    }\n\n    state.engineRunning = true; // resume simulation\n\n    state.onFinishUpdate();\n  }\n});\n\nfunction fromKapsule(kapsule) {\n  var baseClass = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : Object;\n  var initKapsuleWithSelf = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n\n  var FromKapsule = /*#__PURE__*/function (_baseClass) {\n    _inherits(FromKapsule, _baseClass);\n\n    var _super = _createSuper(FromKapsule);\n\n    function FromKapsule() {\n      var _this;\n\n      _classCallCheck(this, FromKapsule);\n\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n\n      _this = _super.call.apply(_super, [this].concat(args));\n      _this.__kapsuleInstance = kapsule().apply(void 0, [].concat(_toConsumableArray(initKapsuleWithSelf ? [_assertThisInitialized(_this)] : []), args));\n      return _this;\n    }\n\n    return FromKapsule;\n  }(baseClass); // attach kapsule props/methods to class prototype\n\n\n  Object.keys(kapsule()).forEach(function (m) {\n    return FromKapsule.prototype[m] = function () {\n      var _this$__kapsuleInstan;\n\n      var returnVal = (_this$__kapsuleInstan = this.__kapsuleInstance)[m].apply(_this$__kapsuleInstan, arguments);\n\n      return returnVal === this.__kapsuleInstance ? this // chain based on this class, not the kapsule obj\n      : returnVal;\n    };\n  });\n  return FromKapsule;\n}\n\nvar three = window.THREE ? window.THREE : {\n  Group: Group\n}; // Prefer consumption from global THREE, if exists\n\nvar threeForcegraph = fromKapsule(ForceGraph, three.Group, true);\nexport default threeForcegraph;","map":{"version":3,"sources":["E:/Universitat Paderborn/NEW/kgsum/kgsum-visualization/node_modules/three-forcegraph/dist/three-forcegraph.module.js"],"names":["Group","Mesh","MeshLambertMaterial","Color","BufferGeometry","BufferAttribute","Matrix4","Vector3","SphereBufferGeometry","CylinderBufferGeometry","TubeBufferGeometry","ConeBufferGeometry","Line","LineBasicMaterial","QuadraticBezierCurve3","CubicBezierCurve3","Box3","forceSimulation","forceLink","forceManyBody","forceCenter","forceRadial","graph","forcelayout","Kapsule","accessorFn","min","max","dataJoint","scaleOrdinal","schemePaired","tinyColor","ownKeys","object","enumerableOnly","keys","Object","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread2","target","i","arguments","length","source","forEach","key","_defineProperty","getOwnPropertyDescriptors","defineProperties","defineProperty","_typeof","obj","Symbol","iterator","constructor","prototype","_classCallCheck","instance","Constructor","TypeError","value","configurable","writable","_inherits","subClass","superClass","create","_setPrototypeOf","_getPrototypeOf","o","setPrototypeOf","getPrototypeOf","__proto__","p","_isNativeReflectConstruct","Reflect","construct","sham","Proxy","Boolean","valueOf","call","e","_construct","Parent","args","Class","a","Function","bind","_objectWithoutPropertiesLoose","excluded","sourceKeys","indexOf","_objectWithoutProperties","sourceSymbolKeys","propertyIsEnumerable","_assertThisInitialized","self","ReferenceError","_possibleConstructorReturn","_createSuper","Derived","hasNativeReflectConstruct","_createSuperInternal","Super","result","NewTarget","_slicedToArray","arr","_arrayWithHoles","_iterableToArrayLimit","_unsupportedIterableToArray","_nonIterableRest","_toConsumableArray","_arrayWithoutHoles","_iterableToArray","_nonIterableSpread","Array","isArray","_arrayLikeToArray","iter","from","_i","_arr","_n","_d","_s","_e","next","done","err","minLen","n","toString","slice","name","test","len","arr2","materialDispose","material","map","dispose","deallocate","geometry","texture","children","emptyObject","childObj","remove","_excluded","threeDigest","data","scene","_ref","undefined","_ref$objFilter","objFilter","options","add","objBindAttr","colorStr2Hex","str","isNaN","parseInt","toHex","colorAlpha","getAlpha","autoColorScale","autoColorObjects","objects","colorByAccessor","colorField","getDagDepths","idAccessor","nodes","links","_ref2","_ref2$nodeFilter","nodeFilter","_ref2$onLoopError","onLoopError","loopIds","concat","join","node","out","depth","skip","_ref3","sourceId","getNodeId","targetId","hasOwnProperty","sourceNode","targetNode","foundLoops","traverse","values","nodeDepths","assign","entries","_ref4","_ref5","_ref6","_ref7","id","nodeStack","currentDepth","l","_ret","loop","d","some","foundLoop","every","idx","three$1","window","THREE","ngraph","DAG_LEVEL_NODE_RATIO","setAttributeFn","setAttribute","applyMatrix4Fn","applyMatrix4","ForceGraph","props","jsonUrl","onChange","state","_this","fetchingJson","onLoading","fetch","then","r","json","onFinishLoading","graphData","triggerUpdate","engineRunning","numDimensions","numDim","chargeForce","d3ForceLayout","force","strength","eraseDimension","dim","dagMode","forceEngine","fx","fy","fz","dagLevelDistance","dagNodeFilter","_default","onDagError","nodeRelSize","nodeId","nodeVal","nodeResolution","nodeColor","nodeAutoColorBy","nodeOpacity","nodeVisibility","nodeThreeObject","nodeThreeObjectExtend","linkSource","linkTarget","linkVisibility","linkColor","linkAutoColorBy","linkOpacity","linkWidth","linkResolution","linkCurvature","linkCurveRotation","linkMaterial","linkThreeObject","linkThreeObjectExtend","linkPositionUpdate","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowRelPos","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleSpeed","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution","d3AlphaMin","d3AlphaDecay","alphaDecay","d3AlphaTarget","alphaTarget","d3VelocityDecay","velocityDecay","ngraphPhysics","timeStep","gravity","theta","springLength","springCoefficient","dragCoefficient","warmupTicks","cooldownTicks","Infinity","cooldownTime","onUpdate","onFinishUpdate","onEngineTick","onEngineStop","methods","refresh","_flushObjects","_rerender","d3Force","forceName","forceFn","d3ReheatSimulation","alpha","resetCountdown","cntTicks","startTickTime","Date","tickFrame","isD3Sim","layoutTick","updateArrows","updatePhotons","layout","__threeObj","pos","getNodePosition","position","x","y","z","linkWidthAccessor","linkCurvatureAccessor","linkCurveRotationAccessor","linkThreeObjectExtendAccessor","link","lineObj","__lineObj","getLinkPosition","getLink","start","end","calcLinkCurve","extendedObj","curveResolution","curve","__curve","line","type","linePos","getAttribute","array","Float32Array","needsUpdate","setFromPoints","getPoints","computeBoundingSphere","match","Math","ceil","makeTranslation","makeRotationX","PI","vStart","vEnd","distance","distanceTo","scale","parent","localToWorld","lookAt","set","rotation","_linkWidth","_r","_geometry","curvature","curveRotation","dx","dy","vLine","subVectors","cp","clone","multiplyScalar","cross","applyAxisAngle","normalize","addVectors","divideScalar","endAngle","startAngle","cos","sin","arrowRelPosAccessor","arrowLengthAccessor","nodeValAccessor","arrowObj","__arrowObj","startR","sqrt","endR","arrowLength","arrowRelPos","getPosAlongLine","t","getPoint","iplt","lineLen","getLength","pow","reduce","acc","v","posAlongLine","arrowHead","arrowTail","headVec","c","particleSpeedAccessor","cyclePhotons","__photonsObj","singleHopPhotons","__singleHopPhotonsObj","particleSpeed","getPhotonPos","photons","photon","singleHop","__linkThreeObjType","__progressRatio","photonPosRatio","emitParticle","graphScene","particleWidthAccessor","photonR","numSegments","particleGeometry","linkColorAccessor","particleColorAccessor","photonColor","materialColor","opacity","particleMaterial","color","transparent","getGraphBbox","initialised","bboxes","getBboxes","computeBoundingBox","box","copy","boundingBox","matrixWorld","__graphObjType","__data","bb","stateInit","stop","init","threeObj","update","changedProps","hasAnyPropChanged","propList","customObjectAccessor","customObjectExtendAccessor","valAccessor","colorAccessor","visibilityAccessor","sphereGeometries","sphereMaterials","purge","createObj","customObj","extendObj","__graphDefaultObj","updateObj","val","radius","cbrt","parameters","widthSegments","equals","_customObjectAccessor","_customObjectExtendAccessor","customMaterialAccessor","_visibilityAccessor","_colorAccessor","widthAccessor","cylinderGeometries","lambertLineMaterials","basicLineMaterials","visibleLinks","defaultObj","useCylinder","lineGeometry","renderOrder","updObj","radiusTop","radialSegments","customMaterial","materialType","lineMaterials","depthWrite","arrowColorAccessor","height","coneGeometry","translate","rotateX","particlesAccessor","particleMaterials","particleGeometries","numPhotons","round","abs","curPhoton","_","linkForce","maxDepth","getFFn","fix","invert","fxFn","fyFn","fzFn","nodeDepth","_graph","addNode","addLink","dimensions","fromKapsule","kapsule","baseClass","initKapsuleWithSelf","FromKapsule","_baseClass","_super","_len","_key","__kapsuleInstance","m","_this$__kapsuleInstan","returnVal","three","threeForcegraph"],"mappings":"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","sourcesContent":["import { Group, Mesh, MeshLambertMaterial, Color, BufferGeometry, BufferAttribute, Matrix4, Vector3, SphereBufferGeometry, CylinderBufferGeometry, TubeBufferGeometry, ConeBufferGeometry, Line, LineBasicMaterial, QuadraticBezierCurve3, CubicBezierCurve3, Box3 } from 'three';\nimport { forceSimulation, forceLink, forceManyBody, forceCenter, forceRadial } from 'd3-force-3d';\nimport graph from 'ngraph.graph';\nimport forcelayout from 'ngraph.forcelayout';\nimport Kapsule from 'kapsule';\nimport accessorFn from 'accessor-fn';\nimport { min, max } from 'd3-array';\nimport dataJoint from 'data-joint';\nimport { scaleOrdinal } from 'd3-scale';\nimport { schemePaired } from 'd3-scale-chromatic';\nimport tinyColor from 'tinycolor2';\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n\n    if (enumerableOnly) {\n      symbols = symbols.filter(function (sym) {\n        return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n      });\n    }\n\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread2(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        _defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nfunction _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    _typeof = function (obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function (obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) _setPrototypeOf(subClass, superClass);\n}\n\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction _construct(Parent, args, Class) {\n  if (_isNativeReflectConstruct()) {\n    _construct = Reflect.construct;\n  } else {\n    _construct = function _construct(Parent, args, Class) {\n      var a = [null];\n      a.push.apply(a, args);\n      var Constructor = Function.bind.apply(Parent, a);\n      var instance = new Constructor();\n      if (Class) _setPrototypeOf(instance, Class.prototype);\n      return instance;\n    };\n  }\n\n  return _construct.apply(null, arguments);\n}\n\nfunction _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n\n  return target;\n}\n\nfunction _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n\n  var target = _objectWithoutPropertiesLoose(source, excluded);\n\n  var key, i;\n\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n\n  return target;\n}\n\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (typeof call === \"object\" || typeof call === \"function\")) {\n    return call;\n  }\n\n  return _assertThisInitialized(self);\n}\n\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n\n  return function _createSuperInternal() {\n    var Super = _getPrototypeOf(Derived),\n        result;\n\n    if (hasNativeReflectConstruct) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n\n    return _possibleConstructorReturn(this, result);\n  };\n}\n\nfunction _slicedToArray(arr, i) {\n  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();\n}\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return _arrayLikeToArray(arr);\n}\n\nfunction _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\n\nfunction _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter);\n}\n\nfunction _iterableToArrayLimit(arr, i) {\n  var _i = arr && (typeof Symbol !== \"undefined\" && arr[Symbol.iterator] || arr[\"@@iterator\"]);\n\n  if (_i == null) return;\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n\n  var _s, _e;\n\n  try {\n    for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\n\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];\n\n  return arr2;\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nvar materialDispose = function materialDispose(material) {\n  if (material instanceof Array) {\n    material.forEach(materialDispose);\n  } else {\n    if (material.map) {\n      material.map.dispose();\n    }\n\n    material.dispose();\n  }\n};\n\nvar deallocate = function deallocate(obj) {\n  if (obj.geometry) {\n    obj.geometry.dispose();\n  }\n\n  if (obj.material) {\n    materialDispose(obj.material);\n  }\n\n  if (obj.texture) {\n    obj.texture.dispose();\n  }\n\n  if (obj.children) {\n    obj.children.forEach(deallocate);\n  }\n};\n\nvar emptyObject = function emptyObject(obj) {\n  while (obj.children.length) {\n    var childObj = obj.children[0];\n    obj.remove(childObj);\n    deallocate(childObj);\n  }\n};\n\nvar _excluded = [\"objFilter\"];\n\nfunction threeDigest(data, scene) {\n  var _ref = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n  var _ref$objFilter = _ref.objFilter,\n      objFilter = _ref$objFilter === void 0 ? function () {\n    return true;\n  } : _ref$objFilter,\n      options = _objectWithoutProperties(_ref, _excluded);\n\n  return dataJoint(data, scene.children.filter(objFilter), function (obj) {\n    return scene.add(obj);\n  }, function (obj) {\n    scene.remove(obj);\n    emptyObject(obj);\n  }, _objectSpread2({\n    objBindAttr: '__threeObj'\n  }, options));\n}\n\nvar colorStr2Hex = function colorStr2Hex(str) {\n  return isNaN(str) ? parseInt(tinyColor(str).toHex(), 16) : str;\n};\n\nvar colorAlpha = function colorAlpha(str) {\n  return isNaN(str) ? tinyColor(str).getAlpha() : 1;\n};\n\nvar autoColorScale = scaleOrdinal(schemePaired); // Autoset attribute colorField by colorByAccessor property\n// If an object has already a color, don't set it\n// Objects can be nodes or links\n\nfunction autoColorObjects(objects, colorByAccessor, colorField) {\n  if (!colorByAccessor || typeof colorField !== 'string') return;\n  objects.filter(function (obj) {\n    return !obj[colorField];\n  }).forEach(function (obj) {\n    obj[colorField] = autoColorScale(colorByAccessor(obj));\n  });\n}\n\nfunction getDagDepths (_ref, idAccessor) {\n  var nodes = _ref.nodes,\n      links = _ref.links;\n\n  var _ref2 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},\n      _ref2$nodeFilter = _ref2.nodeFilter,\n      nodeFilter = _ref2$nodeFilter === void 0 ? function () {\n    return true;\n  } : _ref2$nodeFilter,\n      _ref2$onLoopError = _ref2.onLoopError,\n      onLoopError = _ref2$onLoopError === void 0 ? function (loopIds) {\n    throw \"Invalid DAG structure! Found cycle in node path: \".concat(loopIds.join(' -> '), \".\");\n  } : _ref2$onLoopError;\n\n  // linked graph\n  var graph = {};\n  nodes.forEach(function (node) {\n    return graph[idAccessor(node)] = {\n      data: node,\n      out: [],\n      depth: -1,\n      skip: !nodeFilter(node)\n    };\n  });\n  links.forEach(function (_ref3) {\n    var source = _ref3.source,\n        target = _ref3.target;\n    var sourceId = getNodeId(source);\n    var targetId = getNodeId(target);\n    if (!graph.hasOwnProperty(sourceId)) throw \"Missing source node with id: \".concat(sourceId);\n    if (!graph.hasOwnProperty(targetId)) throw \"Missing target node with id: \".concat(targetId);\n    var sourceNode = graph[sourceId];\n    var targetNode = graph[targetId];\n    sourceNode.out.push(targetNode);\n\n    function getNodeId(node) {\n      return _typeof(node) === 'object' ? idAccessor(node) : node;\n    }\n  });\n  var foundLoops = [];\n  traverse(Object.values(graph));\n  var nodeDepths = Object.assign.apply(Object, [{}].concat(_toConsumableArray(Object.entries(graph).filter(function (_ref4) {\n    var _ref5 = _slicedToArray(_ref4, 2),\n        node = _ref5[1];\n\n    return !node.skip;\n  }).map(function (_ref6) {\n    var _ref7 = _slicedToArray(_ref6, 2),\n        id = _ref7[0],\n        node = _ref7[1];\n\n    return _defineProperty({}, id, node.depth);\n  }))));\n  return nodeDepths;\n\n  function traverse(nodes) {\n    var nodeStack = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n    var currentDepth = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n\n    for (var i = 0, l = nodes.length; i < l; i++) {\n      var node = nodes[i];\n\n      if (nodeStack.indexOf(node) !== -1) {\n        var _ret = function () {\n          var loop = [].concat(_toConsumableArray(nodeStack.slice(nodeStack.indexOf(node))), [node]).map(function (d) {\n            return idAccessor(d.data);\n          });\n\n          if (!foundLoops.some(function (foundLoop) {\n            return foundLoop.length === loop.length && foundLoop.every(function (id, idx) {\n              return id === loop[idx];\n            });\n          })) {\n            foundLoops.push(loop);\n            onLoopError(loop);\n          }\n\n          return \"continue\";\n        }();\n\n        if (_ret === \"continue\") continue;\n      }\n\n      if (currentDepth > node.depth) {\n        // Don't unnecessarily revisit chunks of the graph\n        node.depth = currentDepth;\n        traverse(node.out, [].concat(_toConsumableArray(nodeStack), [node]), currentDepth + (node.skip ? 0 : 1));\n      }\n    }\n  }\n}\n\nvar three$1 = window.THREE ? window.THREE // Prefer consumption from global THREE, if exists\n: {\n  Group: Group,\n  Mesh: Mesh,\n  MeshLambertMaterial: MeshLambertMaterial,\n  Color: Color,\n  BufferGeometry: BufferGeometry,\n  BufferAttribute: BufferAttribute,\n  Matrix4: Matrix4,\n  Vector3: Vector3,\n  SphereBufferGeometry: SphereBufferGeometry,\n  CylinderBufferGeometry: CylinderBufferGeometry,\n  TubeBufferGeometry: TubeBufferGeometry,\n  ConeBufferGeometry: ConeBufferGeometry,\n  Line: Line,\n  LineBasicMaterial: LineBasicMaterial,\n  QuadraticBezierCurve3: QuadraticBezierCurve3,\n  CubicBezierCurve3: CubicBezierCurve3,\n  Box3: Box3\n};\nvar ngraph = {\n  graph: graph,\n  forcelayout: forcelayout\n};\n\nvar DAG_LEVEL_NODE_RATIO = 2; // support multiple method names for backwards threejs compatibility\n\nvar setAttributeFn = new three$1.BufferGeometry().setAttribute ? 'setAttribute' : 'addAttribute';\nvar applyMatrix4Fn = new three$1.BufferGeometry().applyMatrix4 ? 'applyMatrix4' : 'applyMatrix';\nvar ForceGraph = Kapsule({\n  props: {\n    jsonUrl: {\n      onChange: function onChange(jsonUrl, state) {\n        var _this = this;\n\n        if (jsonUrl && !state.fetchingJson) {\n          // Load data asynchronously\n          state.fetchingJson = true;\n          state.onLoading();\n          fetch(jsonUrl).then(function (r) {\n            return r.json();\n          }).then(function (json) {\n            state.fetchingJson = false;\n            state.onFinishLoading(json);\n\n            _this.graphData(json);\n          });\n        }\n      },\n      triggerUpdate: false\n    },\n    graphData: {\n      \"default\": {\n        nodes: [],\n        links: []\n      },\n      onChange: function onChange(graphData, state) {\n        state.engineRunning = false; // Pause simulation immediately\n      }\n    },\n    numDimensions: {\n      \"default\": 3,\n      onChange: function onChange(numDim, state) {\n        var chargeForce = state.d3ForceLayout.force('charge'); // Increase repulsion on 3D mode for improved spatial separation\n\n        if (chargeForce) {\n          chargeForce.strength(numDim > 2 ? -60 : -30);\n        }\n\n        if (numDim < 3) {\n          eraseDimension(state.graphData.nodes, 'z');\n        }\n\n        if (numDim < 2) {\n          eraseDimension(state.graphData.nodes, 'y');\n        }\n\n        function eraseDimension(nodes, dim) {\n          nodes.forEach(function (d) {\n            delete d[dim]; // position\n\n            delete d[\"v\".concat(dim)]; // velocity\n          });\n        }\n      }\n    },\n    dagMode: {\n      onChange: function onChange(dagMode, state) {\n        // td, bu, lr, rl, zin, zout, radialin, radialout\n        !dagMode && state.forceEngine === 'd3' && (state.graphData.nodes || []).forEach(function (n) {\n          return n.fx = n.fy = n.fz = undefined;\n        }); // unfix nodes when disabling dag mode\n      }\n    },\n    dagLevelDistance: {},\n    dagNodeFilter: {\n      \"default\": function _default(node) {\n        return true;\n      }\n    },\n    onDagError: {\n      triggerUpdate: false\n    },\n    nodeRelSize: {\n      \"default\": 4\n    },\n    // volume per val unit\n    nodeId: {\n      \"default\": 'id'\n    },\n    nodeVal: {\n      \"default\": 'val'\n    },\n    nodeResolution: {\n      \"default\": 8\n    },\n    // how many slice segments in the sphere's circumference\n    nodeColor: {\n      \"default\": 'color'\n    },\n    nodeAutoColorBy: {},\n    nodeOpacity: {\n      \"default\": 0.75\n    },\n    nodeVisibility: {\n      \"default\": true\n    },\n    nodeThreeObject: {},\n    nodeThreeObjectExtend: {\n      \"default\": false\n    },\n    linkSource: {\n      \"default\": 'source'\n    },\n    linkTarget: {\n      \"default\": 'target'\n    },\n    linkVisibility: {\n      \"default\": true\n    },\n    linkColor: {\n      \"default\": 'color'\n    },\n    linkAutoColorBy: {},\n    linkOpacity: {\n      \"default\": 0.2\n    },\n    linkWidth: {},\n    // Rounded to nearest decimal. For falsy values use dimensionless line with 1px regardless of distance.\n    linkResolution: {\n      \"default\": 6\n    },\n    // how many radial segments in each line tube's geometry\n    linkCurvature: {\n      \"default\": 0,\n      triggerUpdate: false\n    },\n    // line curvature radius (0: straight, 1: semi-circle)\n    linkCurveRotation: {\n      \"default\": 0,\n      triggerUpdate: false\n    },\n    // line curve rotation along the line axis (0: interection with XY plane, PI: upside down)\n    linkMaterial: {},\n    linkThreeObject: {},\n    linkThreeObjectExtend: {\n      \"default\": false\n    },\n    linkPositionUpdate: {\n      triggerUpdate: false\n    },\n    // custom function to call for updating the link's position. Signature: (threeObj, { start: { x, y, z},  end: { x, y, z }}, link). If the function returns a truthy value, the regular link position update will not run.\n    linkDirectionalArrowLength: {\n      \"default\": 0\n    },\n    linkDirectionalArrowColor: {},\n    linkDirectionalArrowRelPos: {\n      \"default\": 0.5,\n      triggerUpdate: false\n    },\n    // value between 0<>1 indicating the relative pos along the (exposed) line\n    linkDirectionalArrowResolution: {\n      \"default\": 8\n    },\n    // how many slice segments in the arrow's conic circumference\n    linkDirectionalParticles: {\n      \"default\": 0\n    },\n    // animate photons travelling in the link direction\n    linkDirectionalParticleSpeed: {\n      \"default\": 0.01,\n      triggerUpdate: false\n    },\n    // in link length ratio per frame\n    linkDirectionalParticleWidth: {\n      \"default\": 0.5\n    },\n    linkDirectionalParticleColor: {},\n    linkDirectionalParticleResolution: {\n      \"default\": 4\n    },\n    // how many slice segments in the particle sphere's circumference\n    forceEngine: {\n      \"default\": 'd3'\n    },\n    // d3 or ngraph\n    d3AlphaMin: {\n      \"default\": 0,\n      triggerUpdate: false\n    },\n    d3AlphaDecay: {\n      \"default\": 0.0228,\n      triggerUpdate: false,\n      onChange: function onChange(alphaDecay, state) {\n        state.d3ForceLayout.alphaDecay(alphaDecay);\n      }\n    },\n    d3AlphaTarget: {\n      \"default\": 0,\n      triggerUpdate: false,\n      onChange: function onChange(alphaTarget, state) {\n        state.d3ForceLayout.alphaTarget(alphaTarget);\n      }\n    },\n    d3VelocityDecay: {\n      \"default\": 0.4,\n      triggerUpdate: false,\n      onChange: function onChange(velocityDecay, state) {\n        state.d3ForceLayout.velocityDecay(velocityDecay);\n      }\n    },\n    ngraphPhysics: {\n      \"default\": {\n        // defaults from https://github.com/anvaka/ngraph.physics.simulator/blob/master/index.js\n        timeStep: 20,\n        gravity: -1.2,\n        theta: 0.8,\n        springLength: 30,\n        springCoefficient: 0.0008,\n        dragCoefficient: 0.02\n      }\n    },\n    warmupTicks: {\n      \"default\": 0,\n      triggerUpdate: false\n    },\n    // how many times to tick the force engine at init before starting to render\n    cooldownTicks: {\n      \"default\": Infinity,\n      triggerUpdate: false\n    },\n    cooldownTime: {\n      \"default\": 15000,\n      triggerUpdate: false\n    },\n    // ms\n    onLoading: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onFinishLoading: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onUpdate: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onFinishUpdate: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onEngineTick: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onEngineStop: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    }\n  },\n  methods: {\n    refresh: function refresh(state) {\n      state._flushObjects = true;\n\n      state._rerender();\n\n      return this;\n    },\n    // Expose d3 forces for external manipulation\n    d3Force: function d3Force(state, forceName, forceFn) {\n      if (forceFn === undefined) {\n        return state.d3ForceLayout.force(forceName); // Force getter\n      }\n\n      state.d3ForceLayout.force(forceName, forceFn); // Force setter\n\n      return this;\n    },\n    d3ReheatSimulation: function d3ReheatSimulation(state) {\n      state.d3ForceLayout.alpha(1);\n      this.resetCountdown();\n      return this;\n    },\n    // reset cooldown state\n    resetCountdown: function resetCountdown(state) {\n      state.cntTicks = 0;\n      state.startTickTime = new Date();\n      state.engineRunning = true;\n      return this;\n    },\n    tickFrame: function tickFrame(state) {\n      var isD3Sim = state.forceEngine !== 'ngraph';\n\n      if (state.engineRunning) {\n        layoutTick();\n      }\n\n      updateArrows();\n      updatePhotons();\n      return this; //\n\n      function layoutTick() {\n        if (++state.cntTicks > state.cooldownTicks || new Date() - state.startTickTime > state.cooldownTime || isD3Sim && state.d3AlphaMin > 0 && state.d3ForceLayout.alpha() < state.d3AlphaMin) {\n          state.engineRunning = false; // Stop ticking graph\n\n          state.onEngineStop();\n        } else {\n          state.layout[isD3Sim ? 'tick' : 'step'](); // Tick it\n\n          state.onEngineTick();\n        } // Update nodes position\n\n\n        state.graphData.nodes.forEach(function (node) {\n          var obj = node.__threeObj;\n          if (!obj) return;\n          var pos = isD3Sim ? node : state.layout.getNodePosition(node[state.nodeId]);\n          obj.position.x = pos.x;\n          obj.position.y = pos.y || 0;\n          obj.position.z = pos.z || 0;\n        }); // Update links position\n\n        var linkWidthAccessor = accessorFn(state.linkWidth);\n        var linkCurvatureAccessor = accessorFn(state.linkCurvature);\n        var linkCurveRotationAccessor = accessorFn(state.linkCurveRotation);\n        var linkThreeObjectExtendAccessor = accessorFn(state.linkThreeObjectExtend);\n        state.graphData.links.forEach(function (link) {\n          var lineObj = link.__lineObj;\n          if (!lineObj) return;\n          var pos = isD3Sim ? link : state.layout.getLinkPosition(state.layout.graph.getLink(link.source, link.target).id);\n          var start = pos[isD3Sim ? 'source' : 'from'];\n          var end = pos[isD3Sim ? 'target' : 'to'];\n          if (!start || !end || !start.hasOwnProperty('x') || !end.hasOwnProperty('x')) return; // skip invalid link\n\n          calcLinkCurve(link); // calculate link curve for all links, including custom replaced, so it can be used in directional functionality\n\n          var extendedObj = linkThreeObjectExtendAccessor(link);\n\n          if (state.linkPositionUpdate && state.linkPositionUpdate(extendedObj ? lineObj.children[1] : lineObj, // pass child custom object if extending the default\n          {\n            start: {\n              x: start.x,\n              y: start.y,\n              z: start.z\n            },\n            end: {\n              x: end.x,\n              y: end.y,\n              z: end.z\n            }\n          }, link) && !extendedObj) {\n            // exit if successfully custom updated position of non-extended obj\n            return;\n          }\n\n          var curveResolution = 30; // # line segments\n\n          var curve = link.__curve; // select default line obj if it's an extended group\n\n          var line = lineObj.children.length ? lineObj.children[0] : lineObj;\n\n          if (line.type === 'Line') {\n            // Update line geometry\n            if (!curve) {\n              // straight line\n              var linePos = line.geometry.getAttribute('position');\n\n              if (!linePos || !linePos.array || linePos.array.length !== 6) {\n                line.geometry[setAttributeFn]('position', linePos = new three$1.BufferAttribute(new Float32Array(2 * 3), 3));\n              }\n\n              linePos.array[0] = start.x;\n              linePos.array[1] = start.y || 0;\n              linePos.array[2] = start.z || 0;\n              linePos.array[3] = end.x;\n              linePos.array[4] = end.y || 0;\n              linePos.array[5] = end.z || 0;\n              linePos.needsUpdate = true;\n            } else {\n              // bezier curve line\n              line.geometry.setFromPoints(curve.getPoints(curveResolution));\n            }\n\n            line.geometry.computeBoundingSphere();\n          } else if (line.type === 'Mesh') {\n            // Update cylinder geometry\n            if (!curve) {\n              // straight tube\n              if (!line.geometry.type.match(/^Cylinder(Buffer)?Geometry$/)) {\n                var linkWidth = Math.ceil(linkWidthAccessor(link) * 10) / 10;\n                var r = linkWidth / 2;\n                var geometry = new three$1.CylinderBufferGeometry(r, r, 1, state.linkResolution, 1, false);\n                geometry[applyMatrix4Fn](new three$1.Matrix4().makeTranslation(0, 1 / 2, 0));\n                geometry[applyMatrix4Fn](new three$1.Matrix4().makeRotationX(Math.PI / 2));\n                line.geometry.dispose();\n                line.geometry = geometry;\n              }\n\n              var vStart = new three$1.Vector3(start.x, start.y || 0, start.z || 0);\n              var vEnd = new three$1.Vector3(end.x, end.y || 0, end.z || 0);\n              var distance = vStart.distanceTo(vEnd);\n              line.position.x = vStart.x;\n              line.position.y = vStart.y;\n              line.position.z = vStart.z;\n              line.scale.z = distance;\n              line.parent.localToWorld(vEnd); // lookAt requires world coords\n\n              line.lookAt(vEnd);\n            } else {\n              // curved tube\n              if (!line.geometry.type.match(/^Tube(Buffer)?Geometry$/)) {\n                // reset object positioning\n                line.position.set(0, 0, 0);\n                line.rotation.set(0, 0, 0);\n                line.scale.set(1, 1, 1);\n              }\n\n              var _linkWidth = Math.ceil(linkWidthAccessor(link) * 10) / 10;\n\n              var _r = _linkWidth / 2;\n\n              var _geometry = new three$1.TubeBufferGeometry(curve, curveResolution, _r, state.linkResolution, false);\n\n              line.geometry.dispose();\n              line.geometry = _geometry;\n            }\n          }\n        }); //\n\n        function calcLinkCurve(link) {\n          var pos = isD3Sim ? link : state.layout.getLinkPosition(state.layout.graph.getLink(link.source, link.target).id);\n          var start = pos[isD3Sim ? 'source' : 'from'];\n          var end = pos[isD3Sim ? 'target' : 'to'];\n          if (!start || !end || !start.hasOwnProperty('x') || !end.hasOwnProperty('x')) return; // skip invalid link\n\n          var curvature = linkCurvatureAccessor(link);\n\n          if (!curvature) {\n            link.__curve = null; // Straight line\n          } else {\n            // bezier curve line (only for line types)\n            var vStart = new three$1.Vector3(start.x, start.y || 0, start.z || 0);\n            var vEnd = new three$1.Vector3(end.x, end.y || 0, end.z || 0);\n            var l = vStart.distanceTo(vEnd); // line length\n\n            var curve;\n            var curveRotation = linkCurveRotationAccessor(link);\n\n            if (l > 0) {\n              var dx = end.x - start.x;\n              var dy = end.y - start.y || 0;\n              var vLine = new three$1.Vector3().subVectors(vEnd, vStart);\n              var cp = vLine.clone().multiplyScalar(curvature).cross(dx !== 0 || dy !== 0 ? new three$1.Vector3(0, 0, 1) : new three$1.Vector3(0, 1, 0)) // avoid cross-product of parallel vectors (prefer Z, fallback to Y)\n              .applyAxisAngle(vLine.normalize(), curveRotation) // rotate along line axis according to linkCurveRotation\n              .add(new three$1.Vector3().addVectors(vStart, vEnd).divideScalar(2));\n              curve = new three$1.QuadraticBezierCurve3(vStart, cp, vEnd);\n            } else {\n              // Same point, draw a loop\n              var d = curvature * 70;\n              var endAngle = -curveRotation; // Rotate clockwise (from Z angle perspective)\n\n              var startAngle = endAngle + Math.PI / 2;\n              curve = new three$1.CubicBezierCurve3(vStart, new three$1.Vector3(d * Math.cos(startAngle), d * Math.sin(startAngle), 0).add(vStart), new three$1.Vector3(d * Math.cos(endAngle), d * Math.sin(endAngle), 0).add(vStart), vEnd);\n            }\n\n            link.__curve = curve;\n          }\n        }\n      }\n\n      function updateArrows() {\n        // update link arrow position\n        var arrowRelPosAccessor = accessorFn(state.linkDirectionalArrowRelPos);\n        var arrowLengthAccessor = accessorFn(state.linkDirectionalArrowLength);\n        var nodeValAccessor = accessorFn(state.nodeVal);\n        state.graphData.links.forEach(function (link) {\n          var arrowObj = link.__arrowObj;\n          if (!arrowObj) return;\n          var pos = isD3Sim ? link : state.layout.getLinkPosition(state.layout.graph.getLink(link.source, link.target).id);\n          var start = pos[isD3Sim ? 'source' : 'from'];\n          var end = pos[isD3Sim ? 'target' : 'to'];\n          if (!start || !end || !start.hasOwnProperty('x') || !end.hasOwnProperty('x')) return; // skip invalid link\n\n          var startR = Math.sqrt(Math.max(0, nodeValAccessor(start) || 1)) * state.nodeRelSize;\n          var endR = Math.sqrt(Math.max(0, nodeValAccessor(end) || 1)) * state.nodeRelSize;\n          var arrowLength = arrowLengthAccessor(link);\n          var arrowRelPos = arrowRelPosAccessor(link);\n          var getPosAlongLine = link.__curve ? function (t) {\n            return link.__curve.getPoint(t);\n          } // interpolate along bezier curve\n          : function (t) {\n            // straight line: interpolate linearly\n            var iplt = function iplt(dim, start, end, t) {\n              return start[dim] + (end[dim] - start[dim]) * t || 0;\n            };\n\n            return {\n              x: iplt('x', start, end, t),\n              y: iplt('y', start, end, t),\n              z: iplt('z', start, end, t)\n            };\n          };\n          var lineLen = link.__curve ? link.__curve.getLength() : Math.sqrt(['x', 'y', 'z'].map(function (dim) {\n            return Math.pow((end[dim] || 0) - (start[dim] || 0), 2);\n          }).reduce(function (acc, v) {\n            return acc + v;\n          }, 0));\n          var posAlongLine = startR + arrowLength + (lineLen - startR - endR - arrowLength) * arrowRelPos;\n          var arrowHead = getPosAlongLine(posAlongLine / lineLen);\n          var arrowTail = getPosAlongLine((posAlongLine - arrowLength) / lineLen);\n          ['x', 'y', 'z'].forEach(function (dim) {\n            return arrowObj.position[dim] = arrowTail[dim];\n          });\n\n          var headVec = _construct(three$1.Vector3, _toConsumableArray(['x', 'y', 'z'].map(function (c) {\n            return arrowHead[c];\n          })));\n\n          arrowObj.parent.localToWorld(headVec); // lookAt requires world coords\n\n          arrowObj.lookAt(headVec);\n        });\n      }\n\n      function updatePhotons() {\n        // update link particle positions\n        var particleSpeedAccessor = accessorFn(state.linkDirectionalParticleSpeed);\n        state.graphData.links.forEach(function (link) {\n          var cyclePhotons = link.__photonsObj && link.__photonsObj.children;\n          var singleHopPhotons = link.__singleHopPhotonsObj && link.__singleHopPhotonsObj.children;\n          if ((!singleHopPhotons || !singleHopPhotons.length) && (!cyclePhotons || !cyclePhotons.length)) return;\n          var pos = isD3Sim ? link : state.layout.getLinkPosition(state.layout.graph.getLink(link.source, link.target).id);\n          var start = pos[isD3Sim ? 'source' : 'from'];\n          var end = pos[isD3Sim ? 'target' : 'to'];\n          if (!start || !end || !start.hasOwnProperty('x') || !end.hasOwnProperty('x')) return; // skip invalid link\n\n          var particleSpeed = particleSpeedAccessor(link);\n          var getPhotonPos = link.__curve ? function (t) {\n            return link.__curve.getPoint(t);\n          } // interpolate along bezier curve\n          : function (t) {\n            // straight line: interpolate linearly\n            var iplt = function iplt(dim, start, end, t) {\n              return start[dim] + (end[dim] - start[dim]) * t || 0;\n            };\n\n            return {\n              x: iplt('x', start, end, t),\n              y: iplt('y', start, end, t),\n              z: iplt('z', start, end, t)\n            };\n          };\n          var photons = [].concat(_toConsumableArray(cyclePhotons || []), _toConsumableArray(singleHopPhotons || []));\n          photons.forEach(function (photon, idx) {\n            var singleHop = photon.parent.__linkThreeObjType === 'singleHopPhotons';\n\n            if (!photon.hasOwnProperty('__progressRatio')) {\n              photon.__progressRatio = singleHop ? 0 : idx / cyclePhotons.length;\n            }\n\n            photon.__progressRatio += particleSpeed;\n\n            if (photon.__progressRatio >= 1) {\n              if (!singleHop) {\n                photon.__progressRatio = photon.__progressRatio % 1;\n              } else {\n                // remove particle\n                photon.parent.remove(photon);\n                emptyObject(photon);\n                return;\n              }\n            }\n\n            var photonPosRatio = photon.__progressRatio;\n            var pos = getPhotonPos(photonPosRatio);\n            ['x', 'y', 'z'].forEach(function (dim) {\n              return photon.position[dim] = pos[dim];\n            });\n          });\n        });\n      }\n    },\n    emitParticle: function emitParticle(state, link) {\n      if (link) {\n        if (!link.__singleHopPhotonsObj) {\n          var obj = new three$1.Group();\n          obj.__linkThreeObjType = 'singleHopPhotons';\n          link.__singleHopPhotonsObj = obj;\n          state.graphScene.add(obj);\n        }\n\n        var particleWidthAccessor = accessorFn(state.linkDirectionalParticleWidth);\n        var photonR = Math.ceil(particleWidthAccessor(link) * 10) / 10 / 2;\n        var numSegments = state.linkDirectionalParticleResolution;\n        var particleGeometry = new three$1.SphereBufferGeometry(photonR, numSegments, numSegments);\n        var linkColorAccessor = accessorFn(state.linkColor);\n        var particleColorAccessor = accessorFn(state.linkDirectionalParticleColor);\n        var photonColor = particleColorAccessor(link) || linkColorAccessor(link) || '#f0f0f0';\n        var materialColor = new three$1.Color(colorStr2Hex(photonColor));\n        var opacity = state.linkOpacity * 3;\n        var particleMaterial = new three$1.MeshLambertMaterial({\n          color: materialColor,\n          transparent: true,\n          opacity: opacity\n        }); // add a single hop particle\n\n        link.__singleHopPhotonsObj.add(new three$1.Mesh(particleGeometry, particleMaterial));\n      }\n\n      return this;\n    },\n    getGraphBbox: function getGraphBbox(state) {\n      var nodeFilter = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : function () {\n        return true;\n      };\n      if (!state.initialised) return null; // recursively collect all nested geometries bboxes\n\n      var bboxes = function getBboxes(obj) {\n        var bboxes = [];\n\n        if (obj.geometry) {\n          obj.geometry.computeBoundingBox();\n          var box = new three$1.Box3();\n          box.copy(obj.geometry.boundingBox).applyMatrix4(obj.matrixWorld);\n          bboxes.push(box);\n        }\n\n        return bboxes.concat.apply(bboxes, _toConsumableArray((obj.children || []).filter(function (obj) {\n          return !obj.hasOwnProperty('__graphObjType') || obj.__graphObjType === 'node' && nodeFilter(obj.__data);\n        } // exclude filtered out nodes\n        ).map(getBboxes)));\n      }(state.graphScene);\n\n      if (!bboxes.length) return null; // extract global x,y,z min/max\n\n      return Object.assign.apply(Object, _toConsumableArray(['x', 'y', 'z'].map(function (c) {\n        return _defineProperty({}, c, [min(bboxes, function (bb) {\n          return bb.min[c];\n        }), max(bboxes, function (bb) {\n          return bb.max[c];\n        })]);\n      })));\n    }\n  },\n  stateInit: function stateInit() {\n    return {\n      d3ForceLayout: forceSimulation().force('link', forceLink()).force('charge', forceManyBody()).force('center', forceCenter()).force('dagRadial', null).stop(),\n      engineRunning: false\n    };\n  },\n  init: function init(threeObj, state) {\n    // Main three object to manipulate\n    state.graphScene = threeObj;\n  },\n  update: function update(state, changedProps) {\n    var hasAnyPropChanged = function hasAnyPropChanged(propList) {\n      return propList.some(function (p) {\n        return changedProps.hasOwnProperty(p);\n      });\n    };\n\n    state.engineRunning = false; // pause simulation\n\n    state.onUpdate();\n\n    if (state.nodeAutoColorBy !== null && hasAnyPropChanged(['nodeAutoColorBy', 'graphData', 'nodeColor'])) {\n      // Auto add color to uncolored nodes\n      autoColorObjects(state.graphData.nodes, accessorFn(state.nodeAutoColorBy), state.nodeColor);\n    }\n\n    if (state.linkAutoColorBy !== null && hasAnyPropChanged(['linkAutoColorBy', 'graphData', 'linkColor'])) {\n      // Auto add color to uncolored links\n      autoColorObjects(state.graphData.links, accessorFn(state.linkAutoColorBy), state.linkColor);\n    } // Digest nodes WebGL objects\n\n\n    if (state._flushObjects || hasAnyPropChanged(['graphData', 'nodeThreeObject', 'nodeThreeObjectExtend', 'nodeVal', 'nodeColor', 'nodeVisibility', 'nodeRelSize', 'nodeResolution', 'nodeOpacity'])) {\n      var customObjectAccessor = accessorFn(state.nodeThreeObject);\n      var customObjectExtendAccessor = accessorFn(state.nodeThreeObjectExtend);\n      var valAccessor = accessorFn(state.nodeVal);\n      var colorAccessor = accessorFn(state.nodeColor);\n      var visibilityAccessor = accessorFn(state.nodeVisibility);\n      var sphereGeometries = {}; // indexed by node value\n\n      var sphereMaterials = {}; // indexed by color\n\n      threeDigest(state.graphData.nodes.filter(visibilityAccessor), state.graphScene, {\n        purge: state._flushObjects || hasAnyPropChanged([// recreate objects if any of these props have changed\n        'nodeThreeObject', 'nodeThreeObjectExtend']),\n        objFilter: function objFilter(obj) {\n          return obj.__graphObjType === 'node';\n        },\n        createObj: function createObj(node) {\n          var customObj = customObjectAccessor(node);\n          var extendObj = customObjectExtendAccessor(node);\n\n          if (customObj && state.nodeThreeObject === customObj) {\n            // clone object if it's a shared object among all nodes\n            customObj = customObj.clone();\n          }\n\n          var obj;\n\n          if (customObj && !extendObj) {\n            obj = customObj;\n          } else {\n            // Add default object (sphere mesh)\n            obj = new three$1.Mesh();\n            obj.__graphDefaultObj = true;\n\n            if (customObj && extendObj) {\n              obj.add(customObj); // extend default with custom\n            }\n          }\n\n          obj.__graphObjType = 'node'; // Add object type\n\n          return obj;\n        },\n        updateObj: function updateObj(obj, node) {\n          if (obj.__graphDefaultObj) {\n            // bypass internal updates for custom node objects\n            var val = valAccessor(node) || 1;\n            var radius = Math.cbrt(val) * state.nodeRelSize;\n            var numSegments = state.nodeResolution;\n\n            if (!obj.geometry.type.match(/^Sphere(Buffer)?Geometry$/) || obj.geometry.parameters.radius !== radius || obj.geometry.parameters.widthSegments !== numSegments) {\n              if (!sphereGeometries.hasOwnProperty(val)) {\n                sphereGeometries[val] = new three$1.SphereBufferGeometry(radius, numSegments, numSegments);\n              }\n\n              obj.geometry.dispose();\n              obj.geometry = sphereGeometries[val];\n            }\n\n            var color = colorAccessor(node);\n            var materialColor = new three$1.Color(colorStr2Hex(color || '#ffffaa'));\n            var opacity = state.nodeOpacity * colorAlpha(color);\n\n            if (obj.material.type !== 'MeshLambertMaterial' || !obj.material.color.equals(materialColor) || obj.material.opacity !== opacity) {\n              if (!sphereMaterials.hasOwnProperty(color)) {\n                sphereMaterials[color] = new three$1.MeshLambertMaterial({\n                  color: materialColor,\n                  transparent: true,\n                  opacity: opacity\n                });\n              }\n\n              obj.material.dispose();\n              obj.material = sphereMaterials[color];\n            }\n          }\n        }\n      });\n    } // Digest links WebGL objects\n\n\n    if (state._flushObjects || hasAnyPropChanged(['graphData', 'linkThreeObject', 'linkThreeObjectExtend', 'linkMaterial', 'linkColor', 'linkWidth', 'linkVisibility', 'linkResolution', 'linkOpacity', 'linkDirectionalArrowLength', 'linkDirectionalArrowColor', 'linkDirectionalArrowResolution', 'linkDirectionalParticles', 'linkDirectionalParticleWidth', 'linkDirectionalParticleColor', 'linkDirectionalParticleResolution'])) {\n      var _customObjectAccessor = accessorFn(state.linkThreeObject);\n\n      var _customObjectExtendAccessor = accessorFn(state.linkThreeObjectExtend);\n\n      var customMaterialAccessor = accessorFn(state.linkMaterial);\n\n      var _visibilityAccessor = accessorFn(state.linkVisibility);\n\n      var _colorAccessor = accessorFn(state.linkColor);\n\n      var widthAccessor = accessorFn(state.linkWidth);\n      var cylinderGeometries = {}; // indexed by link width\n\n      var lambertLineMaterials = {}; // for cylinder objects, indexed by link color\n\n      var basicLineMaterials = {}; // for line objects, indexed by link color\n\n      var visibleLinks = state.graphData.links.filter(_visibilityAccessor); // lines digest cycle\n\n      threeDigest(visibleLinks, state.graphScene, {\n        objBindAttr: '__lineObj',\n        purge: state._flushObjects || hasAnyPropChanged([// recreate objects if any of these props have changed\n        'linkThreeObject', 'linkThreeObjectExtend', 'linkWidth']),\n        objFilter: function objFilter(obj) {\n          return obj.__graphObjType === 'link';\n        },\n        createObj: function createObj(link) {\n          var customObj = _customObjectAccessor(link);\n\n          var extendObj = _customObjectExtendAccessor(link);\n\n          if (customObj && state.linkThreeObject === customObj) {\n            // clone object if it's a shared object among all links\n            customObj = customObj.clone();\n          }\n\n          var defaultObj;\n\n          if (!customObj || extendObj) {\n            // construct default line obj\n            var useCylinder = !!widthAccessor(link);\n\n            if (useCylinder) {\n              defaultObj = new three$1.Mesh();\n            } else {\n              // Use plain line (constant width)\n              var lineGeometry = new three$1.BufferGeometry();\n              lineGeometry[setAttributeFn]('position', new three$1.BufferAttribute(new Float32Array(2 * 3), 3));\n              defaultObj = new three$1.Line(lineGeometry);\n            }\n          }\n\n          var obj;\n\n          if (!customObj) {\n            obj = defaultObj;\n            obj.__graphDefaultObj = true;\n          } else {\n            if (!extendObj) {\n              // use custom object\n              obj = customObj;\n            } else {\n              // extend default with custom in a group\n              obj = new three$1.Group();\n              obj.__graphDefaultObj = true;\n              obj.add(defaultObj);\n              obj.add(customObj);\n            }\n          }\n\n          obj.renderOrder = 10; // Prevent visual glitches of dark lines on top of nodes by rendering them last\n\n          obj.__graphObjType = 'link'; // Add object type\n\n          return obj;\n        },\n        updateObj: function updateObj(updObj, link) {\n          if (updObj.__graphDefaultObj) {\n            // bypass internal updates for custom link objects\n            // select default object if it's an extended group\n            var obj = updObj.children.length ? updObj.children[0] : updObj;\n            var linkWidth = Math.ceil(widthAccessor(link) * 10) / 10;\n            var useCylinder = !!linkWidth;\n\n            if (useCylinder) {\n              var r = linkWidth / 2;\n              var numSegments = state.linkResolution;\n\n              if (!obj.geometry.type.match(/^Cylinder(Buffer)?Geometry$/) || obj.geometry.parameters.radiusTop !== r || obj.geometry.parameters.radialSegments !== numSegments) {\n                if (!cylinderGeometries.hasOwnProperty(linkWidth)) {\n                  var geometry = new three$1.CylinderBufferGeometry(r, r, 1, numSegments, 1, false);\n                  geometry[applyMatrix4Fn](new three$1.Matrix4().makeTranslation(0, 1 / 2, 0));\n                  geometry[applyMatrix4Fn](new three$1.Matrix4().makeRotationX(Math.PI / 2));\n                  cylinderGeometries[linkWidth] = geometry;\n                }\n\n                obj.geometry.dispose();\n                obj.geometry = cylinderGeometries[linkWidth];\n              }\n            }\n\n            var customMaterial = customMaterialAccessor(link);\n\n            if (customMaterial) {\n              obj.material = customMaterial;\n            } else {\n              var color = _colorAccessor(link);\n\n              var materialColor = new three$1.Color(colorStr2Hex(color || '#f0f0f0'));\n              var opacity = state.linkOpacity * colorAlpha(color);\n              var materialType = useCylinder ? 'MeshLambertMaterial' : 'LineBasicMaterial';\n\n              if (obj.material.type !== materialType || !obj.material.color.equals(materialColor) || obj.material.opacity !== opacity) {\n                var lineMaterials = useCylinder ? lambertLineMaterials : basicLineMaterials;\n\n                if (!lineMaterials.hasOwnProperty(color)) {\n                  lineMaterials[color] = new three$1[materialType]({\n                    color: materialColor,\n                    transparent: opacity < 1,\n                    opacity: opacity,\n                    depthWrite: opacity >= 1 // Prevent transparency issues\n\n                  });\n                }\n\n                obj.material.dispose();\n                obj.material = lineMaterials[color];\n              }\n            }\n          }\n        }\n      }); // Arrows digest cycle\n\n      if (state.linkDirectionalArrowLength || changedProps.hasOwnProperty('linkDirectionalArrowLength')) {\n        var arrowLengthAccessor = accessorFn(state.linkDirectionalArrowLength);\n        var arrowColorAccessor = accessorFn(state.linkDirectionalArrowColor);\n        threeDigest(visibleLinks.filter(arrowLengthAccessor), state.graphScene, {\n          objBindAttr: '__arrowObj',\n          objFilter: function objFilter(obj) {\n            return obj.__linkThreeObjType === 'arrow';\n          },\n          createObj: function createObj() {\n            var obj = new three$1.Mesh(undefined, new three$1.MeshLambertMaterial({\n              transparent: true\n            }));\n            obj.__linkThreeObjType = 'arrow'; // Add object type\n\n            return obj;\n          },\n          updateObj: function updateObj(obj, link) {\n            var arrowLength = arrowLengthAccessor(link);\n            var numSegments = state.linkDirectionalArrowResolution;\n\n            if (!obj.geometry.type.match(/^Cone(Buffer)?Geometry$/) || obj.geometry.parameters.height !== arrowLength || obj.geometry.parameters.radialSegments !== numSegments) {\n              var coneGeometry = new three$1.ConeBufferGeometry(arrowLength * 0.25, arrowLength, numSegments); // Correct orientation\n\n              coneGeometry.translate(0, arrowLength / 2, 0);\n              coneGeometry.rotateX(Math.PI / 2);\n              obj.geometry.dispose();\n              obj.geometry = coneGeometry;\n            }\n\n            obj.material.color = new three$1.Color(arrowColorAccessor(link) || _colorAccessor(link) || '#f0f0f0');\n            obj.material.opacity = state.linkOpacity * 3;\n          }\n        });\n      } // Photon particles digest cycle\n\n\n      if (state.linkDirectionalParticles || changedProps.hasOwnProperty('linkDirectionalParticles')) {\n        var particlesAccessor = accessorFn(state.linkDirectionalParticles);\n        var particleWidthAccessor = accessorFn(state.linkDirectionalParticleWidth);\n        var particleColorAccessor = accessorFn(state.linkDirectionalParticleColor);\n        var particleMaterials = {}; // indexed by link color\n\n        var particleGeometries = {}; // indexed by particle width\n\n        threeDigest(visibleLinks.filter(particlesAccessor), state.graphScene, {\n          objBindAttr: '__photonsObj',\n          objFilter: function objFilter(obj) {\n            return obj.__linkThreeObjType === 'photons';\n          },\n          createObj: function createObj() {\n            var obj = new three$1.Group();\n            obj.__linkThreeObjType = 'photons'; // Add object type\n\n            return obj;\n          },\n          updateObj: function updateObj(obj, link) {\n            var numPhotons = Math.round(Math.abs(particlesAccessor(link)));\n            var curPhoton = !!obj.children.length && obj.children[0];\n            var photonR = Math.ceil(particleWidthAccessor(link) * 10) / 10 / 2;\n            var numSegments = state.linkDirectionalParticleResolution;\n            var particleGeometry;\n\n            if (curPhoton && curPhoton.geometry.parameters.radius === photonR && curPhoton.geometry.parameters.widthSegments === numSegments) {\n              particleGeometry = curPhoton.geometry;\n            } else {\n              if (!particleGeometries.hasOwnProperty(photonR)) {\n                particleGeometries[photonR] = new three$1.SphereBufferGeometry(photonR, numSegments, numSegments);\n              }\n\n              particleGeometry = particleGeometries[photonR];\n              curPhoton && curPhoton.geometry.dispose();\n            }\n\n            var photonColor = particleColorAccessor(link) || _colorAccessor(link) || '#f0f0f0';\n            var materialColor = new three$1.Color(colorStr2Hex(photonColor));\n            var opacity = state.linkOpacity * 3;\n            var particleMaterial;\n\n            if (curPhoton && curPhoton.material.color.equals(materialColor) && curPhoton.material.opacity === opacity) {\n              particleMaterial = curPhoton.material;\n            } else {\n              if (!particleMaterials.hasOwnProperty(photonColor)) {\n                particleMaterials[photonColor] = new three$1.MeshLambertMaterial({\n                  color: materialColor,\n                  transparent: true,\n                  opacity: opacity\n                });\n              }\n\n              particleMaterial = particleMaterials[photonColor];\n              curPhoton && curPhoton.material.dispose();\n            } // digest cycle for each photon\n\n\n            threeDigest(_toConsumableArray(new Array(numPhotons)).map(function (_, idx) {\n              return {\n                idx: idx\n              };\n            }), obj, {\n              idAccessor: function idAccessor(d) {\n                return d.idx;\n              },\n              createObj: function createObj() {\n                return new three$1.Mesh(particleGeometry, particleMaterial);\n              },\n              updateObj: function updateObj(obj) {\n                obj.geometry = particleGeometry;\n                obj.material = particleMaterial;\n              }\n            });\n          }\n        });\n      }\n    }\n\n    state._flushObjects = false; // reset objects refresh flag\n    // simulation engine\n\n    if (hasAnyPropChanged(['graphData', 'nodeId', 'linkSource', 'linkTarget', 'numDimensions', 'forceEngine', 'dagMode', 'dagNodeFilter', 'dagLevelDistance'])) {\n      state.engineRunning = false; // Pause simulation\n      // parse links\n\n      state.graphData.links.forEach(function (link) {\n        link.source = link[state.linkSource];\n        link.target = link[state.linkTarget];\n      }); // Feed data to force-directed layout\n\n      var isD3Sim = state.forceEngine !== 'ngraph';\n      var layout;\n\n      if (isD3Sim) {\n        // D3-force\n        (layout = state.d3ForceLayout).stop().alpha(1) // re-heat the simulation\n        .numDimensions(state.numDimensions).nodes(state.graphData.nodes); // add links (if link force is still active)\n\n        var linkForce = state.d3ForceLayout.force('link');\n\n        if (linkForce) {\n          linkForce.id(function (d) {\n            return d[state.nodeId];\n          }).links(state.graphData.links);\n        } // setup dag force constraints\n\n\n        var nodeDepths = state.dagMode && getDagDepths(state.graphData, function (node) {\n          return node[state.nodeId];\n        }, {\n          nodeFilter: state.dagNodeFilter,\n          onLoopError: state.onDagError || undefined\n        });\n        var maxDepth = Math.max.apply(Math, _toConsumableArray(Object.values(nodeDepths || [])));\n        var dagLevelDistance = state.dagLevelDistance || state.graphData.nodes.length / (maxDepth || 1) * DAG_LEVEL_NODE_RATIO * (['radialin', 'radialout'].indexOf(state.dagMode) !== -1 ? 0.7 : 1); // Fix nodes to x,y,z for dag mode\n\n        if (state.dagMode) {\n          var getFFn = function getFFn(fix, invert) {\n            return function (node) {\n              return !fix ? undefined : (nodeDepths[node[state.nodeId]] - maxDepth / 2) * dagLevelDistance * (invert ? -1 : 1);\n            };\n          };\n\n          var fxFn = getFFn(['lr', 'rl'].indexOf(state.dagMode) !== -1, state.dagMode === 'rl');\n          var fyFn = getFFn(['td', 'bu'].indexOf(state.dagMode) !== -1, state.dagMode === 'td');\n          var fzFn = getFFn(['zin', 'zout'].indexOf(state.dagMode) !== -1, state.dagMode === 'zout');\n          state.graphData.nodes.filter(state.dagNodeFilter).forEach(function (node) {\n            node.fx = fxFn(node);\n            node.fy = fyFn(node);\n            node.fz = fzFn(node);\n          });\n        } // Use radial force for radial dags\n\n\n        state.d3ForceLayout.force('dagRadial', ['radialin', 'radialout'].indexOf(state.dagMode) !== -1 ? forceRadial(function (node) {\n          var nodeDepth = nodeDepths[node[state.nodeId]] || -1;\n          return (state.dagMode === 'radialin' ? maxDepth - nodeDepth : nodeDepth) * dagLevelDistance;\n        }).strength(function (node) {\n          return state.dagNodeFilter(node) ? 1 : 0;\n        }) : null);\n      } else {\n        // ngraph\n        var _graph = ngraph.graph();\n\n        state.graphData.nodes.forEach(function (node) {\n          _graph.addNode(node[state.nodeId]);\n        });\n        state.graphData.links.forEach(function (link) {\n          _graph.addLink(link.source, link.target);\n        });\n        layout = ngraph.forcelayout(_graph, _objectSpread2({\n          dimensions: state.numDimensions\n        }, state.ngraphPhysics));\n        layout.graph = _graph; // Attach graph reference to layout\n      }\n\n      for (var i = 0; i < state.warmupTicks && !(isD3Sim && state.d3AlphaMin > 0 && state.d3ForceLayout.alpha() < state.d3AlphaMin); i++) {\n        layout[isD3Sim ? \"tick\" : \"step\"]();\n      } // Initial ticks before starting to render\n\n\n      state.layout = layout;\n      this.resetCountdown();\n    }\n\n    state.engineRunning = true; // resume simulation\n\n    state.onFinishUpdate();\n  }\n});\n\nfunction fromKapsule (kapsule) {\n  var baseClass = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : Object;\n  var initKapsuleWithSelf = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n\n  var FromKapsule = /*#__PURE__*/function (_baseClass) {\n    _inherits(FromKapsule, _baseClass);\n\n    var _super = _createSuper(FromKapsule);\n\n    function FromKapsule() {\n      var _this;\n\n      _classCallCheck(this, FromKapsule);\n\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n\n      _this = _super.call.apply(_super, [this].concat(args));\n      _this.__kapsuleInstance = kapsule().apply(void 0, [].concat(_toConsumableArray(initKapsuleWithSelf ? [_assertThisInitialized(_this)] : []), args));\n      return _this;\n    }\n\n    return FromKapsule;\n  }(baseClass); // attach kapsule props/methods to class prototype\n\n\n  Object.keys(kapsule()).forEach(function (m) {\n    return FromKapsule.prototype[m] = function () {\n      var _this$__kapsuleInstan;\n\n      var returnVal = (_this$__kapsuleInstan = this.__kapsuleInstance)[m].apply(_this$__kapsuleInstan, arguments);\n\n      return returnVal === this.__kapsuleInstance ? this // chain based on this class, not the kapsule obj\n      : returnVal;\n    };\n  });\n  return FromKapsule;\n}\n\nvar three = window.THREE ? window.THREE : {\n  Group: Group\n}; // Prefer consumption from global THREE, if exists\nvar threeForcegraph = fromKapsule(ForceGraph, three.Group, true);\n\nexport default threeForcegraph;\n"]},"metadata":{},"sourceType":"module"}